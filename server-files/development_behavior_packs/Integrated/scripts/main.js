import{Entity as jr}from"@minecraft/server";Object.defineProperty(jr.prototype,"ae2",{get(){let t=this;return t._proto_temp??={get boundBlockLocation(){return t.getDynamicProperty("boundBlockLocation")},set boundBlockLocation(e){t.setDynamicProperty("boundBlockLocation",e)},temp:new Map}}});import{system as oi}from"@minecraft/server";var E;(function(t){t.assertEqual=a=>a;function e(a){}t.assertIs=e;function n(a){throw new Error}t.assertNever=n,t.arrayToEnum=a=>{let o={};for(let i of a)o[i]=i;return o},t.getValidEnumValues=a=>{let o=t.objectKeys(a).filter(s=>typeof a[a[s]]!="number"),i={};for(let s of o)i[s]=a[s];return t.objectValues(i)},t.objectValues=a=>t.objectKeys(a).map(function(o){return a[o]}),t.objectKeys=typeof Object.keys=="function"?a=>Object.keys(a):a=>{let o=[];for(let i in a)Object.prototype.hasOwnProperty.call(a,i)&&o.push(i);return o},t.find=(a,o)=>{for(let i of a)if(o(i))return i},t.isInteger=typeof Number.isInteger=="function"?a=>Number.isInteger(a):a=>typeof a=="number"&&isFinite(a)&&Math.floor(a)===a;function r(a,o=" | "){return a.map(i=>typeof i=="string"?`'${i}'`:i).join(o)}t.joinValues=r,t.jsonStringifyReplacer=(a,o)=>typeof o=="bigint"?o.toString():o})(E||(E={}));var Dt;(function(t){t.mergeShapes=(e,n)=>({...e,...n})})(Dt||(Dt={}));var y=E.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),X=t=>{switch(typeof t){case"undefined":return y.undefined;case"string":return y.string;case"number":return isNaN(t)?y.nan:y.number;case"boolean":return y.boolean;case"function":return y.function;case"bigint":return y.bigint;case"symbol":return y.symbol;case"object":return Array.isArray(t)?y.array:t===null?y.null:t.then&&typeof t.then=="function"&&t.catch&&typeof t.catch=="function"?y.promise:typeof Map<"u"&&t instanceof Map?y.map:typeof Set<"u"&&t instanceof Set?y.set:typeof Date<"u"&&t instanceof Date?y.date:y.object;default:return y.unknown}},f=E.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]),Lr=t=>JSON.stringify(t,null,2).replace(/"([^"]+)":/g,"$1:"),B=class t extends Error{get errors(){return this.issues}constructor(e){super(),this.issues=[],this.addIssue=r=>{this.issues=[...this.issues,r]},this.addIssues=(r=[])=>{this.issues=[...this.issues,...r]};let n=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,n):this.__proto__=n,this.name="ZodError",this.issues=e}format(e){let n=e||function(o){return o.message},r={_errors:[]},a=o=>{for(let i of o.issues)if(i.code==="invalid_union")i.unionErrors.map(a);else if(i.code==="invalid_return_type")a(i.returnTypeError);else if(i.code==="invalid_arguments")a(i.argumentsError);else if(i.path.length===0)r._errors.push(n(i));else{let s=r,u=0;for(;u<i.path.length;){let c=i.path[u];u===i.path.length-1?(s[c]=s[c]||{_errors:[]},s[c]._errors.push(n(i))):s[c]=s[c]||{_errors:[]},s=s[c],u++}}};return a(this),r}static assert(e){if(!(e instanceof t))throw new Error(`Not a ZodError: ${e}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,E.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(e=n=>n.message){let n={},r=[];for(let a of this.issues)a.path.length>0?(n[a.path[0]]=n[a.path[0]]||[],n[a.path[0]].push(e(a))):r.push(e(a));return{formErrors:r,fieldErrors:n}}get formErrors(){return this.flatten()}};B.create=t=>new B(t);var Pe=(t,e)=>{let n;switch(t.code){case f.invalid_type:t.received===y.undefined?n="Required":n=`Expected ${t.expected}, received ${t.received}`;break;case f.invalid_literal:n=`Invalid literal value, expected ${JSON.stringify(t.expected,E.jsonStringifyReplacer)}`;break;case f.unrecognized_keys:n=`Unrecognized key(s) in object: ${E.joinValues(t.keys,", ")}`;break;case f.invalid_union:n="Invalid input";break;case f.invalid_union_discriminator:n=`Invalid discriminator value. Expected ${E.joinValues(t.options)}`;break;case f.invalid_enum_value:n=`Invalid enum value. Expected ${E.joinValues(t.options)}, received '${t.received}'`;break;case f.invalid_arguments:n="Invalid function arguments";break;case f.invalid_return_type:n="Invalid function return type";break;case f.invalid_date:n="Invalid date";break;case f.invalid_string:typeof t.validation=="object"?"includes"in t.validation?(n=`Invalid input: must include "${t.validation.includes}"`,typeof t.validation.position=="number"&&(n=`${n} at one or more positions greater than or equal to ${t.validation.position}`)):"startsWith"in t.validation?n=`Invalid input: must start with "${t.validation.startsWith}"`:"endsWith"in t.validation?n=`Invalid input: must end with "${t.validation.endsWith}"`:E.assertNever(t.validation):t.validation!=="regex"?n=`Invalid ${t.validation}`:n="Invalid";break;case f.too_small:t.type==="array"?n=`Array must contain ${t.exact?"exactly":t.inclusive?"at least":"more than"} ${t.minimum} element(s)`:t.type==="string"?n=`String must contain ${t.exact?"exactly":t.inclusive?"at least":"over"} ${t.minimum} character(s)`:t.type==="number"?n=`Number must be ${t.exact?"exactly equal to ":t.inclusive?"greater than or equal to ":"greater than "}${t.minimum}`:t.type==="date"?n=`Date must be ${t.exact?"exactly equal to ":t.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(t.minimum))}`:n="Invalid input";break;case f.too_big:t.type==="array"?n=`Array must contain ${t.exact?"exactly":t.inclusive?"at most":"less than"} ${t.maximum} element(s)`:t.type==="string"?n=`String must contain ${t.exact?"exactly":t.inclusive?"at most":"under"} ${t.maximum} character(s)`:t.type==="number"?n=`Number must be ${t.exact?"exactly":t.inclusive?"less than or equal to":"less than"} ${t.maximum}`:t.type==="bigint"?n=`BigInt must be ${t.exact?"exactly":t.inclusive?"less than or equal to":"less than"} ${t.maximum}`:t.type==="date"?n=`Date must be ${t.exact?"exactly":t.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(t.maximum))}`:n="Invalid input";break;case f.custom:n="Invalid input";break;case f.invalid_intersection_types:n="Intersection results could not be merged";break;case f.not_multiple_of:n=`Number must be a multiple of ${t.multipleOf}`;break;case f.not_finite:n="Number must be finite";break;default:n=e.defaultError,E.assertNever(t)}return{message:n}},kn=Pe;function Fr(t){kn=t}function at(){return kn}var ot=t=>{let{data:e,path:n,errorMaps:r,issueData:a}=t,o=[...n,...a.path||[]],i={...a,path:o};if(a.message!==void 0)return{...a,path:o,message:a.message};let s="",u=r.filter(c=>!!c).slice().reverse();for(let c of u)s=c(i,{data:e,defaultError:s}).message;return{...a,path:o,message:s}},Zr=[];function h(t,e){let n=at(),r=ot({issueData:e,data:t.data,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,n,n===Pe?void 0:Pe].filter(a=>!!a)});t.common.issues.push(r)}var P=class t{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(e,n){let r=[];for(let a of n){if(a.status==="aborted")return I;a.status==="dirty"&&e.dirty(),r.push(a.value)}return{status:e.value,value:r}}static async mergeObjectAsync(e,n){let r=[];for(let a of n){let o=await a.key,i=await a.value;r.push({key:o,value:i})}return t.mergeObjectSync(e,r)}static mergeObjectSync(e,n){let r={};for(let a of n){let{key:o,value:i}=a;if(o.status==="aborted"||i.status==="aborted")return I;o.status==="dirty"&&e.dirty(),i.status==="dirty"&&e.dirty(),o.value!=="__proto__"&&(typeof i.value<"u"||a.alwaysSet)&&(r[o.value]=i.value)}return{status:e.value,value:r}}},I=Object.freeze({status:"aborted"}),De=t=>({status:"dirty",value:t}),M=t=>({status:"valid",value:t}),Pt=t=>t.status==="aborted",zt=t=>t.status==="dirty",me=t=>t.status==="valid",He=t=>typeof Promise<"u"&&t instanceof Promise;function it(t,e,n,r){if(n==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?t!==e||!r:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return n==="m"?r:n==="a"?r.call(t):r?r.value:e.get(t)}function vn(t,e,n,r,a){if(r==="m")throw new TypeError("Private method is not writable");if(r==="a"&&!a)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?t!==e||!a:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return r==="a"?a.call(t,n):a?a.value=n:e.set(t,n),n}var _;(function(t){t.errToObj=e=>typeof e=="string"?{message:e}:e||{},t.toString=e=>typeof e=="string"?e:e?.message})(_||(_={}));var We,Je,F=class{constructor(e,n,r,a){this._cachedPath=[],this.parent=e,this.data=n,this._path=r,this._key=a}get path(){return this._cachedPath.length||(this._key instanceof Array?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}},_n=(t,e)=>{if(me(e))return{success:!0,data:e.value};if(!t.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;let n=new B(t.common.issues);return this._error=n,this._error}}};function v(t){if(!t)return{};let{errorMap:e,invalid_type_error:n,required_error:r,description:a}=t;if(e&&(n||r))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return e?{errorMap:e,description:a}:{errorMap:(i,s)=>{var u,c;let{message:d}=t;return i.code==="invalid_enum_value"?{message:d??s.defaultError}:typeof s.data>"u"?{message:(u=d??r)!==null&&u!==void 0?u:s.defaultError}:i.code!=="invalid_type"?{message:s.defaultError}:{message:(c=d??n)!==null&&c!==void 0?c:s.defaultError}},description:a}}var S=class{get description(){return this._def.description}_getType(e){return X(e.data)}_getOrReturnCtx(e,n){return n||{common:e.parent.common,data:e.data,parsedType:X(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new P,ctx:{common:e.parent.common,data:e.data,parsedType:X(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){let n=this._parse(e);if(He(n))throw new Error("Synchronous parse encountered promise.");return n}_parseAsync(e){let n=this._parse(e);return Promise.resolve(n)}parse(e,n){let r=this.safeParse(e,n);if(r.success)return r.data;throw r.error}safeParse(e,n){var r;let a={common:{issues:[],async:(r=n?.async)!==null&&r!==void 0?r:!1,contextualErrorMap:n?.errorMap},path:n?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:X(e)},o=this._parseSync({data:e,path:a.path,parent:a});return _n(a,o)}"~validate"(e){var n,r;let a={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:X(e)};if(!this["~standard"].async)try{let o=this._parseSync({data:e,path:[],parent:a});return me(o)?{value:o.value}:{issues:a.common.issues}}catch(o){!((r=(n=o?.message)===null||n===void 0?void 0:n.toLowerCase())===null||r===void 0)&&r.includes("encountered")&&(this["~standard"].async=!0),a.common={issues:[],async:!0}}return this._parseAsync({data:e,path:[],parent:a}).then(o=>me(o)?{value:o.value}:{issues:a.common.issues})}async parseAsync(e,n){let r=await this.safeParseAsync(e,n);if(r.success)return r.data;throw r.error}async safeParseAsync(e,n){let r={common:{issues:[],contextualErrorMap:n?.errorMap,async:!0},path:n?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:X(e)},a=this._parse({data:e,path:r.path,parent:r}),o=await(He(a)?a:Promise.resolve(a));return _n(r,o)}refine(e,n){let r=a=>typeof n=="string"||typeof n>"u"?{message:n}:typeof n=="function"?n(a):n;return this._refinement((a,o)=>{let i=e(a),s=()=>o.addIssue({code:f.custom,...r(a)});return typeof Promise<"u"&&i instanceof Promise?i.then(u=>u?!0:(s(),!1)):i?!0:(s(),!1)})}refinement(e,n){return this._refinement((r,a)=>e(r)?!0:(a.addIssue(typeof n=="function"?n(r,a):n),!1))}_refinement(e){return new j({schema:this,typeName:b.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:n=>this["~validate"](n)}}optional(){return L.create(this,this._def)}nullable(){return W.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return Q.create(this)}promise(){return ie.create(this,this._def)}or(e){return be.create([this,e],this._def)}and(e){return Ie.create(this,e,this._def)}transform(e){return new j({...v(this._def),schema:this,typeName:b.ZodEffects,effect:{type:"transform",transform:e}})}default(e){let n=typeof e=="function"?e:()=>e;return new we({...v(this._def),innerType:this,defaultValue:n,typeName:b.ZodDefault})}brand(){return new Ke({typeName:b.ZodBranded,type:this,...v(this._def)})}catch(e){let n=typeof e=="function"?e:()=>e;return new Ce({...v(this._def),innerType:this,catchValue:n,typeName:b.ZodCatch})}describe(e){let n=this.constructor;return new n({...this._def,description:e})}pipe(e){return Xe.create(this,e)}readonly(){return Ee.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}},qr=/^c[^\s-]{8,}$/i,Ur=/^[0-9a-z]+$/,Gr=/^[0-9A-HJKMNP-TV-Z]{26}$/i,Wr=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,Jr=/^[a-z0-9_-]{21}$/i,Hr=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,Kr=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,Xr=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,Yr="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$",At,Qr=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,ea=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,ta=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,na=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,ra=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,aa=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,Sn="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",oa=new RegExp(`^${Sn}$`);function xn(t){let e="[0-5]\\d";t.precision?e=`${e}\\.\\d{${t.precision}}`:t.precision==null&&(e=`${e}(\\.\\d+)?`);let n=t.precision?"+":"?";return`([01]\\d|2[0-3]):[0-5]\\d(:${e})${n}`}function ia(t){return new RegExp(`^${xn(t)}$`)}function wn(t){let e=`${Sn}T${xn(t)}`,n=[];return n.push(t.local?"Z?":"Z"),t.offset&&n.push("([+-]\\d{2}:?\\d{2})"),e=`${e}(${n.join("|")})`,new RegExp(`^${e}$`)}function sa(t,e){return!!((e==="v4"||!e)&&Qr.test(t)||(e==="v6"||!e)&&ta.test(t))}function ca(t,e){if(!Hr.test(t))return!1;try{let[n]=t.split("."),r=n.replace(/-/g,"+").replace(/_/g,"/").padEnd(n.length+(4-n.length%4)%4,"="),a=JSON.parse(atob(r));return!(typeof a!="object"||a===null||!a.typ||!a.alg||e&&a.alg!==e)}catch{return!1}}function ua(t,e){return!!((e==="v4"||!e)&&ea.test(t)||(e==="v6"||!e)&&na.test(t))}var ae=class t extends S{_parse(e){if(this._def.coerce&&(e.data=String(e.data)),this._getType(e)!==y.string){let o=this._getOrReturnCtx(e);return h(o,{code:f.invalid_type,expected:y.string,received:o.parsedType}),I}let r=new P,a;for(let o of this._def.checks)if(o.kind==="min")e.data.length<o.value&&(a=this._getOrReturnCtx(e,a),h(a,{code:f.too_small,minimum:o.value,type:"string",inclusive:!0,exact:!1,message:o.message}),r.dirty());else if(o.kind==="max")e.data.length>o.value&&(a=this._getOrReturnCtx(e,a),h(a,{code:f.too_big,maximum:o.value,type:"string",inclusive:!0,exact:!1,message:o.message}),r.dirty());else if(o.kind==="length"){let i=e.data.length>o.value,s=e.data.length<o.value;(i||s)&&(a=this._getOrReturnCtx(e,a),i?h(a,{code:f.too_big,maximum:o.value,type:"string",inclusive:!0,exact:!0,message:o.message}):s&&h(a,{code:f.too_small,minimum:o.value,type:"string",inclusive:!0,exact:!0,message:o.message}),r.dirty())}else if(o.kind==="email")Xr.test(e.data)||(a=this._getOrReturnCtx(e,a),h(a,{validation:"email",code:f.invalid_string,message:o.message}),r.dirty());else if(o.kind==="emoji")At||(At=new RegExp(Yr,"u")),At.test(e.data)||(a=this._getOrReturnCtx(e,a),h(a,{validation:"emoji",code:f.invalid_string,message:o.message}),r.dirty());else if(o.kind==="uuid")Wr.test(e.data)||(a=this._getOrReturnCtx(e,a),h(a,{validation:"uuid",code:f.invalid_string,message:o.message}),r.dirty());else if(o.kind==="nanoid")Jr.test(e.data)||(a=this._getOrReturnCtx(e,a),h(a,{validation:"nanoid",code:f.invalid_string,message:o.message}),r.dirty());else if(o.kind==="cuid")qr.test(e.data)||(a=this._getOrReturnCtx(e,a),h(a,{validation:"cuid",code:f.invalid_string,message:o.message}),r.dirty());else if(o.kind==="cuid2")Ur.test(e.data)||(a=this._getOrReturnCtx(e,a),h(a,{validation:"cuid2",code:f.invalid_string,message:o.message}),r.dirty());else if(o.kind==="ulid")Gr.test(e.data)||(a=this._getOrReturnCtx(e,a),h(a,{validation:"ulid",code:f.invalid_string,message:o.message}),r.dirty());else if(o.kind==="url")try{new URL(e.data)}catch{a=this._getOrReturnCtx(e,a),h(a,{validation:"url",code:f.invalid_string,message:o.message}),r.dirty()}else o.kind==="regex"?(o.regex.lastIndex=0,o.regex.test(e.data)||(a=this._getOrReturnCtx(e,a),h(a,{validation:"regex",code:f.invalid_string,message:o.message}),r.dirty())):o.kind==="trim"?e.data=e.data.trim():o.kind==="includes"?e.data.includes(o.value,o.position)||(a=this._getOrReturnCtx(e,a),h(a,{code:f.invalid_string,validation:{includes:o.value,position:o.position},message:o.message}),r.dirty()):o.kind==="toLowerCase"?e.data=e.data.toLowerCase():o.kind==="toUpperCase"?e.data=e.data.toUpperCase():o.kind==="startsWith"?e.data.startsWith(o.value)||(a=this._getOrReturnCtx(e,a),h(a,{code:f.invalid_string,validation:{startsWith:o.value},message:o.message}),r.dirty()):o.kind==="endsWith"?e.data.endsWith(o.value)||(a=this._getOrReturnCtx(e,a),h(a,{code:f.invalid_string,validation:{endsWith:o.value},message:o.message}),r.dirty()):o.kind==="datetime"?wn(o).test(e.data)||(a=this._getOrReturnCtx(e,a),h(a,{code:f.invalid_string,validation:"datetime",message:o.message}),r.dirty()):o.kind==="date"?oa.test(e.data)||(a=this._getOrReturnCtx(e,a),h(a,{code:f.invalid_string,validation:"date",message:o.message}),r.dirty()):o.kind==="time"?ia(o).test(e.data)||(a=this._getOrReturnCtx(e,a),h(a,{code:f.invalid_string,validation:"time",message:o.message}),r.dirty()):o.kind==="duration"?Kr.test(e.data)||(a=this._getOrReturnCtx(e,a),h(a,{validation:"duration",code:f.invalid_string,message:o.message}),r.dirty()):o.kind==="ip"?sa(e.data,o.version)||(a=this._getOrReturnCtx(e,a),h(a,{validation:"ip",code:f.invalid_string,message:o.message}),r.dirty()):o.kind==="jwt"?ca(e.data,o.alg)||(a=this._getOrReturnCtx(e,a),h(a,{validation:"jwt",code:f.invalid_string,message:o.message}),r.dirty()):o.kind==="cidr"?ua(e.data,o.version)||(a=this._getOrReturnCtx(e,a),h(a,{validation:"cidr",code:f.invalid_string,message:o.message}),r.dirty()):o.kind==="base64"?ra.test(e.data)||(a=this._getOrReturnCtx(e,a),h(a,{validation:"base64",code:f.invalid_string,message:o.message}),r.dirty()):o.kind==="base64url"?aa.test(e.data)||(a=this._getOrReturnCtx(e,a),h(a,{validation:"base64url",code:f.invalid_string,message:o.message}),r.dirty()):E.assertNever(o);return{status:r.value,value:e.data}}_regex(e,n,r){return this.refinement(a=>e.test(a),{validation:n,code:f.invalid_string,..._.errToObj(r)})}_addCheck(e){return new t({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",..._.errToObj(e)})}url(e){return this._addCheck({kind:"url",..._.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",..._.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",..._.errToObj(e)})}nanoid(e){return this._addCheck({kind:"nanoid",..._.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",..._.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",..._.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",..._.errToObj(e)})}base64(e){return this._addCheck({kind:"base64",..._.errToObj(e)})}base64url(e){return this._addCheck({kind:"base64url",..._.errToObj(e)})}jwt(e){return this._addCheck({kind:"jwt",..._.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",..._.errToObj(e)})}cidr(e){return this._addCheck({kind:"cidr",..._.errToObj(e)})}datetime(e){var n,r;return typeof e=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:e}):this._addCheck({kind:"datetime",precision:typeof e?.precision>"u"?null:e?.precision,offset:(n=e?.offset)!==null&&n!==void 0?n:!1,local:(r=e?.local)!==null&&r!==void 0?r:!1,..._.errToObj(e?.message)})}date(e){return this._addCheck({kind:"date",message:e})}time(e){return typeof e=="string"?this._addCheck({kind:"time",precision:null,message:e}):this._addCheck({kind:"time",precision:typeof e?.precision>"u"?null:e?.precision,..._.errToObj(e?.message)})}duration(e){return this._addCheck({kind:"duration",..._.errToObj(e)})}regex(e,n){return this._addCheck({kind:"regex",regex:e,..._.errToObj(n)})}includes(e,n){return this._addCheck({kind:"includes",value:e,position:n?.position,..._.errToObj(n?.message)})}startsWith(e,n){return this._addCheck({kind:"startsWith",value:e,..._.errToObj(n)})}endsWith(e,n){return this._addCheck({kind:"endsWith",value:e,..._.errToObj(n)})}min(e,n){return this._addCheck({kind:"min",value:e,..._.errToObj(n)})}max(e,n){return this._addCheck({kind:"max",value:e,..._.errToObj(n)})}length(e,n){return this._addCheck({kind:"length",value:e,..._.errToObj(n)})}nonempty(e){return this.min(1,_.errToObj(e))}trim(){return new t({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new t({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new t({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(e=>e.kind==="datetime")}get isDate(){return!!this._def.checks.find(e=>e.kind==="date")}get isTime(){return!!this._def.checks.find(e=>e.kind==="time")}get isDuration(){return!!this._def.checks.find(e=>e.kind==="duration")}get isEmail(){return!!this._def.checks.find(e=>e.kind==="email")}get isURL(){return!!this._def.checks.find(e=>e.kind==="url")}get isEmoji(){return!!this._def.checks.find(e=>e.kind==="emoji")}get isUUID(){return!!this._def.checks.find(e=>e.kind==="uuid")}get isNANOID(){return!!this._def.checks.find(e=>e.kind==="nanoid")}get isCUID(){return!!this._def.checks.find(e=>e.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(e=>e.kind==="cuid2")}get isULID(){return!!this._def.checks.find(e=>e.kind==="ulid")}get isIP(){return!!this._def.checks.find(e=>e.kind==="ip")}get isCIDR(){return!!this._def.checks.find(e=>e.kind==="cidr")}get isBase64(){return!!this._def.checks.find(e=>e.kind==="base64")}get isBase64url(){return!!this._def.checks.find(e=>e.kind==="base64url")}get minLength(){let e=null;for(let n of this._def.checks)n.kind==="min"&&(e===null||n.value>e)&&(e=n.value);return e}get maxLength(){let e=null;for(let n of this._def.checks)n.kind==="max"&&(e===null||n.value<e)&&(e=n.value);return e}};ae.create=t=>{var e;return new ae({checks:[],typeName:b.ZodString,coerce:(e=t?.coerce)!==null&&e!==void 0?e:!1,...v(t)})};function da(t,e){let n=(t.toString().split(".")[1]||"").length,r=(e.toString().split(".")[1]||"").length,a=n>r?n:r,o=parseInt(t.toFixed(a).replace(".","")),i=parseInt(e.toFixed(a).replace(".",""));return o%i/Math.pow(10,a)}var fe=class t extends S{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){if(this._def.coerce&&(e.data=Number(e.data)),this._getType(e)!==y.number){let o=this._getOrReturnCtx(e);return h(o,{code:f.invalid_type,expected:y.number,received:o.parsedType}),I}let r,a=new P;for(let o of this._def.checks)o.kind==="int"?E.isInteger(e.data)||(r=this._getOrReturnCtx(e,r),h(r,{code:f.invalid_type,expected:"integer",received:"float",message:o.message}),a.dirty()):o.kind==="min"?(o.inclusive?e.data<o.value:e.data<=o.value)&&(r=this._getOrReturnCtx(e,r),h(r,{code:f.too_small,minimum:o.value,type:"number",inclusive:o.inclusive,exact:!1,message:o.message}),a.dirty()):o.kind==="max"?(o.inclusive?e.data>o.value:e.data>=o.value)&&(r=this._getOrReturnCtx(e,r),h(r,{code:f.too_big,maximum:o.value,type:"number",inclusive:o.inclusive,exact:!1,message:o.message}),a.dirty()):o.kind==="multipleOf"?da(e.data,o.value)!==0&&(r=this._getOrReturnCtx(e,r),h(r,{code:f.not_multiple_of,multipleOf:o.value,message:o.message}),a.dirty()):o.kind==="finite"?Number.isFinite(e.data)||(r=this._getOrReturnCtx(e,r),h(r,{code:f.not_finite,message:o.message}),a.dirty()):E.assertNever(o);return{status:a.value,value:e.data}}gte(e,n){return this.setLimit("min",e,!0,_.toString(n))}gt(e,n){return this.setLimit("min",e,!1,_.toString(n))}lte(e,n){return this.setLimit("max",e,!0,_.toString(n))}lt(e,n){return this.setLimit("max",e,!1,_.toString(n))}setLimit(e,n,r,a){return new t({...this._def,checks:[...this._def.checks,{kind:e,value:n,inclusive:r,message:_.toString(a)}]})}_addCheck(e){return new t({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:_.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:_.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:_.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:_.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:_.toString(e)})}multipleOf(e,n){return this._addCheck({kind:"multipleOf",value:e,message:_.toString(n)})}finite(e){return this._addCheck({kind:"finite",message:_.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:_.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:_.toString(e)})}get minValue(){let e=null;for(let n of this._def.checks)n.kind==="min"&&(e===null||n.value>e)&&(e=n.value);return e}get maxValue(){let e=null;for(let n of this._def.checks)n.kind==="max"&&(e===null||n.value<e)&&(e=n.value);return e}get isInt(){return!!this._def.checks.find(e=>e.kind==="int"||e.kind==="multipleOf"&&E.isInteger(e.value))}get isFinite(){let e=null,n=null;for(let r of this._def.checks){if(r.kind==="finite"||r.kind==="int"||r.kind==="multipleOf")return!0;r.kind==="min"?(n===null||r.value>n)&&(n=r.value):r.kind==="max"&&(e===null||r.value<e)&&(e=r.value)}return Number.isFinite(n)&&Number.isFinite(e)}};fe.create=t=>new fe({checks:[],typeName:b.ZodNumber,coerce:t?.coerce||!1,...v(t)});var pe=class t extends S{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){if(this._def.coerce)try{e.data=BigInt(e.data)}catch{return this._getInvalidInput(e)}if(this._getType(e)!==y.bigint)return this._getInvalidInput(e);let r,a=new P;for(let o of this._def.checks)o.kind==="min"?(o.inclusive?e.data<o.value:e.data<=o.value)&&(r=this._getOrReturnCtx(e,r),h(r,{code:f.too_small,type:"bigint",minimum:o.value,inclusive:o.inclusive,message:o.message}),a.dirty()):o.kind==="max"?(o.inclusive?e.data>o.value:e.data>=o.value)&&(r=this._getOrReturnCtx(e,r),h(r,{code:f.too_big,type:"bigint",maximum:o.value,inclusive:o.inclusive,message:o.message}),a.dirty()):o.kind==="multipleOf"?e.data%o.value!==BigInt(0)&&(r=this._getOrReturnCtx(e,r),h(r,{code:f.not_multiple_of,multipleOf:o.value,message:o.message}),a.dirty()):E.assertNever(o);return{status:a.value,value:e.data}}_getInvalidInput(e){let n=this._getOrReturnCtx(e);return h(n,{code:f.invalid_type,expected:y.bigint,received:n.parsedType}),I}gte(e,n){return this.setLimit("min",e,!0,_.toString(n))}gt(e,n){return this.setLimit("min",e,!1,_.toString(n))}lte(e,n){return this.setLimit("max",e,!0,_.toString(n))}lt(e,n){return this.setLimit("max",e,!1,_.toString(n))}setLimit(e,n,r,a){return new t({...this._def,checks:[...this._def.checks,{kind:e,value:n,inclusive:r,message:_.toString(a)}]})}_addCheck(e){return new t({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:_.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:_.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:_.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:_.toString(e)})}multipleOf(e,n){return this._addCheck({kind:"multipleOf",value:e,message:_.toString(n)})}get minValue(){let e=null;for(let n of this._def.checks)n.kind==="min"&&(e===null||n.value>e)&&(e=n.value);return e}get maxValue(){let e=null;for(let n of this._def.checks)n.kind==="max"&&(e===null||n.value<e)&&(e=n.value);return e}};pe.create=t=>{var e;return new pe({checks:[],typeName:b.ZodBigInt,coerce:(e=t?.coerce)!==null&&e!==void 0?e:!1,...v(t)})};var he=class extends S{_parse(e){if(this._def.coerce&&(e.data=!!e.data),this._getType(e)!==y.boolean){let r=this._getOrReturnCtx(e);return h(r,{code:f.invalid_type,expected:y.boolean,received:r.parsedType}),I}return M(e.data)}};he.create=t=>new he({typeName:b.ZodBoolean,coerce:t?.coerce||!1,...v(t)});var ye=class t extends S{_parse(e){if(this._def.coerce&&(e.data=new Date(e.data)),this._getType(e)!==y.date){let o=this._getOrReturnCtx(e);return h(o,{code:f.invalid_type,expected:y.date,received:o.parsedType}),I}if(isNaN(e.data.getTime())){let o=this._getOrReturnCtx(e);return h(o,{code:f.invalid_date}),I}let r=new P,a;for(let o of this._def.checks)o.kind==="min"?e.data.getTime()<o.value&&(a=this._getOrReturnCtx(e,a),h(a,{code:f.too_small,message:o.message,inclusive:!0,exact:!1,minimum:o.value,type:"date"}),r.dirty()):o.kind==="max"?e.data.getTime()>o.value&&(a=this._getOrReturnCtx(e,a),h(a,{code:f.too_big,message:o.message,inclusive:!0,exact:!1,maximum:o.value,type:"date"}),r.dirty()):E.assertNever(o);return{status:r.value,value:new Date(e.data.getTime())}}_addCheck(e){return new t({...this._def,checks:[...this._def.checks,e]})}min(e,n){return this._addCheck({kind:"min",value:e.getTime(),message:_.toString(n)})}max(e,n){return this._addCheck({kind:"max",value:e.getTime(),message:_.toString(n)})}get minDate(){let e=null;for(let n of this._def.checks)n.kind==="min"&&(e===null||n.value>e)&&(e=n.value);return e!=null?new Date(e):null}get maxDate(){let e=null;for(let n of this._def.checks)n.kind==="max"&&(e===null||n.value<e)&&(e=n.value);return e!=null?new Date(e):null}};ye.create=t=>new ye({checks:[],coerce:t?.coerce||!1,typeName:b.ZodDate,...v(t)});var ze=class extends S{_parse(e){if(this._getType(e)!==y.symbol){let r=this._getOrReturnCtx(e);return h(r,{code:f.invalid_type,expected:y.symbol,received:r.parsedType}),I}return M(e.data)}};ze.create=t=>new ze({typeName:b.ZodSymbol,...v(t)});var ge=class extends S{_parse(e){if(this._getType(e)!==y.undefined){let r=this._getOrReturnCtx(e);return h(r,{code:f.invalid_type,expected:y.undefined,received:r.parsedType}),I}return M(e.data)}};ge.create=t=>new ge({typeName:b.ZodUndefined,...v(t)});var _e=class extends S{_parse(e){if(this._getType(e)!==y.null){let r=this._getOrReturnCtx(e);return h(r,{code:f.invalid_type,expected:y.null,received:r.parsedType}),I}return M(e.data)}};_e.create=t=>new _e({typeName:b.ZodNull,...v(t)});var oe=class extends S{constructor(){super(...arguments),this._any=!0}_parse(e){return M(e.data)}};oe.create=t=>new oe({typeName:b.ZodAny,...v(t)});var Y=class extends S{constructor(){super(...arguments),this._unknown=!0}_parse(e){return M(e.data)}};Y.create=t=>new Y({typeName:b.ZodUnknown,...v(t)});var q=class extends S{_parse(e){let n=this._getOrReturnCtx(e);return h(n,{code:f.invalid_type,expected:y.never,received:n.parsedType}),I}};q.create=t=>new q({typeName:b.ZodNever,...v(t)});var Me=class extends S{_parse(e){if(this._getType(e)!==y.undefined){let r=this._getOrReturnCtx(e);return h(r,{code:f.invalid_type,expected:y.void,received:r.parsedType}),I}return M(e.data)}};Me.create=t=>new Me({typeName:b.ZodVoid,...v(t)});var Q=class t extends S{_parse(e){let{ctx:n,status:r}=this._processInputParams(e),a=this._def;if(n.parsedType!==y.array)return h(n,{code:f.invalid_type,expected:y.array,received:n.parsedType}),I;if(a.exactLength!==null){let i=n.data.length>a.exactLength.value,s=n.data.length<a.exactLength.value;(i||s)&&(h(n,{code:i?f.too_big:f.too_small,minimum:s?a.exactLength.value:void 0,maximum:i?a.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:a.exactLength.message}),r.dirty())}if(a.minLength!==null&&n.data.length<a.minLength.value&&(h(n,{code:f.too_small,minimum:a.minLength.value,type:"array",inclusive:!0,exact:!1,message:a.minLength.message}),r.dirty()),a.maxLength!==null&&n.data.length>a.maxLength.value&&(h(n,{code:f.too_big,maximum:a.maxLength.value,type:"array",inclusive:!0,exact:!1,message:a.maxLength.message}),r.dirty()),n.common.async)return Promise.all([...n.data].map((i,s)=>a.type._parseAsync(new F(n,i,n.path,s)))).then(i=>P.mergeArray(r,i));let o=[...n.data].map((i,s)=>a.type._parseSync(new F(n,i,n.path,s)));return P.mergeArray(r,o)}get element(){return this._def.type}min(e,n){return new t({...this._def,minLength:{value:e,message:_.toString(n)}})}max(e,n){return new t({...this._def,maxLength:{value:e,message:_.toString(n)}})}length(e,n){return new t({...this._def,exactLength:{value:e,message:_.toString(n)}})}nonempty(e){return this.min(1,e)}};Q.create=(t,e)=>new Q({type:t,minLength:null,maxLength:null,exactLength:null,typeName:b.ZodArray,...v(e)});function Ae(t){if(t instanceof V){let e={};for(let n in t.shape){let r=t.shape[n];e[n]=L.create(Ae(r))}return new V({...t._def,shape:()=>e})}else return t instanceof Q?new Q({...t._def,type:Ae(t.element)}):t instanceof L?L.create(Ae(t.unwrap())):t instanceof W?W.create(Ae(t.unwrap())):t instanceof G?G.create(t.items.map(e=>Ae(e))):t}var V=class t extends S{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(this._cached!==null)return this._cached;let e=this._def.shape(),n=E.objectKeys(e);return this._cached={shape:e,keys:n}}_parse(e){if(this._getType(e)!==y.object){let c=this._getOrReturnCtx(e);return h(c,{code:f.invalid_type,expected:y.object,received:c.parsedType}),I}let{status:r,ctx:a}=this._processInputParams(e),{shape:o,keys:i}=this._getCached(),s=[];if(!(this._def.catchall instanceof q&&this._def.unknownKeys==="strip"))for(let c in a.data)i.includes(c)||s.push(c);let u=[];for(let c of i){let d=o[c],l=a.data[c];u.push({key:{status:"valid",value:c},value:d._parse(new F(a,l,a.path,c)),alwaysSet:c in a.data})}if(this._def.catchall instanceof q){let c=this._def.unknownKeys;if(c==="passthrough")for(let d of s)u.push({key:{status:"valid",value:d},value:{status:"valid",value:a.data[d]}});else if(c==="strict")s.length>0&&(h(a,{code:f.unrecognized_keys,keys:s}),r.dirty());else if(c!=="strip")throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{let c=this._def.catchall;for(let d of s){let l=a.data[d];u.push({key:{status:"valid",value:d},value:c._parse(new F(a,l,a.path,d)),alwaysSet:d in a.data})}}return a.common.async?Promise.resolve().then(async()=>{let c=[];for(let d of u){let l=await d.key,p=await d.value;c.push({key:l,value:p,alwaysSet:d.alwaysSet})}return c}).then(c=>P.mergeObjectSync(r,c)):P.mergeObjectSync(r,u)}get shape(){return this._def.shape()}strict(e){return _.errToObj,new t({...this._def,unknownKeys:"strict",...e!==void 0?{errorMap:(n,r)=>{var a,o,i,s;let u=(i=(o=(a=this._def).errorMap)===null||o===void 0?void 0:o.call(a,n,r).message)!==null&&i!==void 0?i:r.defaultError;return n.code==="unrecognized_keys"?{message:(s=_.errToObj(e).message)!==null&&s!==void 0?s:u}:{message:u}}}:{}})}strip(){return new t({...this._def,unknownKeys:"strip"})}passthrough(){return new t({...this._def,unknownKeys:"passthrough"})}extend(e){return new t({...this._def,shape:()=>({...this._def.shape(),...e})})}merge(e){return new t({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:()=>({...this._def.shape(),...e._def.shape()}),typeName:b.ZodObject})}setKey(e,n){return this.augment({[e]:n})}catchall(e){return new t({...this._def,catchall:e})}pick(e){let n={};return E.objectKeys(e).forEach(r=>{e[r]&&this.shape[r]&&(n[r]=this.shape[r])}),new t({...this._def,shape:()=>n})}omit(e){let n={};return E.objectKeys(this.shape).forEach(r=>{e[r]||(n[r]=this.shape[r])}),new t({...this._def,shape:()=>n})}deepPartial(){return Ae(this)}partial(e){let n={};return E.objectKeys(this.shape).forEach(r=>{let a=this.shape[r];e&&!e[r]?n[r]=a:n[r]=a.optional()}),new t({...this._def,shape:()=>n})}required(e){let n={};return E.objectKeys(this.shape).forEach(r=>{if(e&&!e[r])n[r]=this.shape[r];else{let o=this.shape[r];for(;o instanceof L;)o=o._def.innerType;n[r]=o}}),new t({...this._def,shape:()=>n})}keyof(){return Cn(E.objectKeys(this.shape))}};V.create=(t,e)=>new V({shape:()=>t,unknownKeys:"strip",catchall:q.create(),typeName:b.ZodObject,...v(e)});V.strictCreate=(t,e)=>new V({shape:()=>t,unknownKeys:"strict",catchall:q.create(),typeName:b.ZodObject,...v(e)});V.lazycreate=(t,e)=>new V({shape:t,unknownKeys:"strip",catchall:q.create(),typeName:b.ZodObject,...v(e)});var be=class extends S{_parse(e){let{ctx:n}=this._processInputParams(e),r=this._def.options;function a(o){for(let s of o)if(s.result.status==="valid")return s.result;for(let s of o)if(s.result.status==="dirty")return n.common.issues.push(...s.ctx.common.issues),s.result;let i=o.map(s=>new B(s.ctx.common.issues));return h(n,{code:f.invalid_union,unionErrors:i}),I}if(n.common.async)return Promise.all(r.map(async o=>{let i={...n,common:{...n.common,issues:[]},parent:null};return{result:await o._parseAsync({data:n.data,path:n.path,parent:i}),ctx:i}})).then(a);{let o,i=[];for(let u of r){let c={...n,common:{...n.common,issues:[]},parent:null},d=u._parseSync({data:n.data,path:n.path,parent:c});if(d.status==="valid")return d;d.status==="dirty"&&!o&&(o={result:d,ctx:c}),c.common.issues.length&&i.push(c.common.issues)}if(o)return n.common.issues.push(...o.ctx.common.issues),o.result;let s=i.map(u=>new B(u));return h(n,{code:f.invalid_union,unionErrors:s}),I}}get options(){return this._def.options}};be.create=(t,e)=>new be({options:t,typeName:b.ZodUnion,...v(e)});var K=t=>t instanceof ke?K(t.schema):t instanceof j?K(t.innerType()):t instanceof ve?[t.value]:t instanceof Se?t.options:t instanceof xe?E.objectValues(t.enum):t instanceof we?K(t._def.innerType):t instanceof ge?[void 0]:t instanceof _e?[null]:t instanceof L?[void 0,...K(t.unwrap())]:t instanceof W?[null,...K(t.unwrap())]:t instanceof Ke||t instanceof Ee?K(t.unwrap()):t instanceof Ce?K(t._def.innerType):[],st=class t extends S{_parse(e){let{ctx:n}=this._processInputParams(e);if(n.parsedType!==y.object)return h(n,{code:f.invalid_type,expected:y.object,received:n.parsedType}),I;let r=this.discriminator,a=n.data[r],o=this.optionsMap.get(a);return o?n.common.async?o._parseAsync({data:n.data,path:n.path,parent:n}):o._parseSync({data:n.data,path:n.path,parent:n}):(h(n,{code:f.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[r]}),I)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(e,n,r){let a=new Map;for(let o of n){let i=K(o.shape[e]);if(!i.length)throw new Error(`A discriminator value for key \`${e}\` could not be extracted from all schema options`);for(let s of i){if(a.has(s))throw new Error(`Discriminator property ${String(e)} has duplicate value ${String(s)}`);a.set(s,o)}}return new t({typeName:b.ZodDiscriminatedUnion,discriminator:e,options:n,optionsMap:a,...v(r)})}};function Mt(t,e){let n=X(t),r=X(e);if(t===e)return{valid:!0,data:t};if(n===y.object&&r===y.object){let a=E.objectKeys(e),o=E.objectKeys(t).filter(s=>a.indexOf(s)!==-1),i={...t,...e};for(let s of o){let u=Mt(t[s],e[s]);if(!u.valid)return{valid:!1};i[s]=u.data}return{valid:!0,data:i}}else if(n===y.array&&r===y.array){if(t.length!==e.length)return{valid:!1};let a=[];for(let o=0;o<t.length;o++){let i=t[o],s=e[o],u=Mt(i,s);if(!u.valid)return{valid:!1};a.push(u.data)}return{valid:!0,data:a}}else return n===y.date&&r===y.date&&+t==+e?{valid:!0,data:t}:{valid:!1}}var Ie=class extends S{_parse(e){let{status:n,ctx:r}=this._processInputParams(e),a=(o,i)=>{if(Pt(o)||Pt(i))return I;let s=Mt(o.value,i.value);return s.valid?((zt(o)||zt(i))&&n.dirty(),{status:n.value,value:s.data}):(h(r,{code:f.invalid_intersection_types}),I)};return r.common.async?Promise.all([this._def.left._parseAsync({data:r.data,path:r.path,parent:r}),this._def.right._parseAsync({data:r.data,path:r.path,parent:r})]).then(([o,i])=>a(o,i)):a(this._def.left._parseSync({data:r.data,path:r.path,parent:r}),this._def.right._parseSync({data:r.data,path:r.path,parent:r}))}};Ie.create=(t,e,n)=>new Ie({left:t,right:e,typeName:b.ZodIntersection,...v(n)});var G=class t extends S{_parse(e){let{status:n,ctx:r}=this._processInputParams(e);if(r.parsedType!==y.array)return h(r,{code:f.invalid_type,expected:y.array,received:r.parsedType}),I;if(r.data.length<this._def.items.length)return h(r,{code:f.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),I;!this._def.rest&&r.data.length>this._def.items.length&&(h(r,{code:f.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),n.dirty());let o=[...r.data].map((i,s)=>{let u=this._def.items[s]||this._def.rest;return u?u._parse(new F(r,i,r.path,s)):null}).filter(i=>!!i);return r.common.async?Promise.all(o).then(i=>P.mergeArray(n,i)):P.mergeArray(n,o)}get items(){return this._def.items}rest(e){return new t({...this._def,rest:e})}};G.create=(t,e)=>{if(!Array.isArray(t))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new G({items:t,typeName:b.ZodTuple,rest:null,...v(e)})};var ct=class t extends S{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){let{status:n,ctx:r}=this._processInputParams(e);if(r.parsedType!==y.object)return h(r,{code:f.invalid_type,expected:y.object,received:r.parsedType}),I;let a=[],o=this._def.keyType,i=this._def.valueType;for(let s in r.data)a.push({key:o._parse(new F(r,s,r.path,s)),value:i._parse(new F(r,r.data[s],r.path,s)),alwaysSet:s in r.data});return r.common.async?P.mergeObjectAsync(n,a):P.mergeObjectSync(n,a)}get element(){return this._def.valueType}static create(e,n,r){return n instanceof S?new t({keyType:e,valueType:n,typeName:b.ZodRecord,...v(r)}):new t({keyType:ae.create(),valueType:e,typeName:b.ZodRecord,...v(n)})}},$e=class extends S{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){let{status:n,ctx:r}=this._processInputParams(e);if(r.parsedType!==y.map)return h(r,{code:f.invalid_type,expected:y.map,received:r.parsedType}),I;let a=this._def.keyType,o=this._def.valueType,i=[...r.data.entries()].map(([s,u],c)=>({key:a._parse(new F(r,s,r.path,[c,"key"])),value:o._parse(new F(r,u,r.path,[c,"value"]))}));if(r.common.async){let s=new Map;return Promise.resolve().then(async()=>{for(let u of i){let c=await u.key,d=await u.value;if(c.status==="aborted"||d.status==="aborted")return I;(c.status==="dirty"||d.status==="dirty")&&n.dirty(),s.set(c.value,d.value)}return{status:n.value,value:s}})}else{let s=new Map;for(let u of i){let c=u.key,d=u.value;if(c.status==="aborted"||d.status==="aborted")return I;(c.status==="dirty"||d.status==="dirty")&&n.dirty(),s.set(c.value,d.value)}return{status:n.value,value:s}}}};$e.create=(t,e,n)=>new $e({valueType:e,keyType:t,typeName:b.ZodMap,...v(n)});var Ve=class t extends S{_parse(e){let{status:n,ctx:r}=this._processInputParams(e);if(r.parsedType!==y.set)return h(r,{code:f.invalid_type,expected:y.set,received:r.parsedType}),I;let a=this._def;a.minSize!==null&&r.data.size<a.minSize.value&&(h(r,{code:f.too_small,minimum:a.minSize.value,type:"set",inclusive:!0,exact:!1,message:a.minSize.message}),n.dirty()),a.maxSize!==null&&r.data.size>a.maxSize.value&&(h(r,{code:f.too_big,maximum:a.maxSize.value,type:"set",inclusive:!0,exact:!1,message:a.maxSize.message}),n.dirty());let o=this._def.valueType;function i(u){let c=new Set;for(let d of u){if(d.status==="aborted")return I;d.status==="dirty"&&n.dirty(),c.add(d.value)}return{status:n.value,value:c}}let s=[...r.data.values()].map((u,c)=>o._parse(new F(r,u,r.path,c)));return r.common.async?Promise.all(s).then(u=>i(u)):i(s)}min(e,n){return new t({...this._def,minSize:{value:e,message:_.toString(n)}})}max(e,n){return new t({...this._def,maxSize:{value:e,message:_.toString(n)}})}size(e,n){return this.min(e,n).max(e,n)}nonempty(e){return this.min(1,e)}};Ve.create=(t,e)=>new Ve({valueType:t,minSize:null,maxSize:null,typeName:b.ZodSet,...v(e)});var ut=class t extends S{constructor(){super(...arguments),this.validate=this.implement}_parse(e){let{ctx:n}=this._processInputParams(e);if(n.parsedType!==y.function)return h(n,{code:f.invalid_type,expected:y.function,received:n.parsedType}),I;function r(s,u){return ot({data:s,path:n.path,errorMaps:[n.common.contextualErrorMap,n.schemaErrorMap,at(),Pe].filter(c=>!!c),issueData:{code:f.invalid_arguments,argumentsError:u}})}function a(s,u){return ot({data:s,path:n.path,errorMaps:[n.common.contextualErrorMap,n.schemaErrorMap,at(),Pe].filter(c=>!!c),issueData:{code:f.invalid_return_type,returnTypeError:u}})}let o={errorMap:n.common.contextualErrorMap},i=n.data;if(this._def.returns instanceof ie){let s=this;return M(async function(...u){let c=new B([]),d=await s._def.args.parseAsync(u,o).catch(m=>{throw c.addIssue(r(u,m)),c}),l=await Reflect.apply(i,this,d);return await s._def.returns._def.type.parseAsync(l,o).catch(m=>{throw c.addIssue(a(l,m)),c})})}else{let s=this;return M(function(...u){let c=s._def.args.safeParse(u,o);if(!c.success)throw new B([r(u,c.error)]);let d=Reflect.apply(i,this,c.data),l=s._def.returns.safeParse(d,o);if(!l.success)throw new B([a(d,l.error)]);return l.data})}}parameters(){return this._def.args}returnType(){return this._def.returns}args(...e){return new t({...this._def,args:G.create(e).rest(Y.create())})}returns(e){return new t({...this._def,returns:e})}implement(e){return this.parse(e)}strictImplement(e){return this.parse(e)}static create(e,n,r){return new t({args:e||G.create([]).rest(Y.create()),returns:n||Y.create(),typeName:b.ZodFunction,...v(r)})}},ke=class extends S{get schema(){return this._def.getter()}_parse(e){let{ctx:n}=this._processInputParams(e);return this._def.getter()._parse({data:n.data,path:n.path,parent:n})}};ke.create=(t,e)=>new ke({getter:t,typeName:b.ZodLazy,...v(e)});var ve=class extends S{_parse(e){if(e.data!==this._def.value){let n=this._getOrReturnCtx(e);return h(n,{received:n.data,code:f.invalid_literal,expected:this._def.value}),I}return{status:"valid",value:e.data}}get value(){return this._def.value}};ve.create=(t,e)=>new ve({value:t,typeName:b.ZodLiteral,...v(e)});function Cn(t,e){return new Se({values:t,typeName:b.ZodEnum,...v(e)})}var Se=class t extends S{constructor(){super(...arguments),We.set(this,void 0)}_parse(e){if(typeof e.data!="string"){let n=this._getOrReturnCtx(e),r=this._def.values;return h(n,{expected:E.joinValues(r),received:n.parsedType,code:f.invalid_type}),I}if(it(this,We,"f")||vn(this,We,new Set(this._def.values),"f"),!it(this,We,"f").has(e.data)){let n=this._getOrReturnCtx(e),r=this._def.values;return h(n,{received:n.data,code:f.invalid_enum_value,options:r}),I}return M(e.data)}get options(){return this._def.values}get enum(){let e={};for(let n of this._def.values)e[n]=n;return e}get Values(){let e={};for(let n of this._def.values)e[n]=n;return e}get Enum(){let e={};for(let n of this._def.values)e[n]=n;return e}extract(e,n=this._def){return t.create(e,{...this._def,...n})}exclude(e,n=this._def){return t.create(this.options.filter(r=>!e.includes(r)),{...this._def,...n})}};We=new WeakMap;Se.create=Cn;var xe=class extends S{constructor(){super(...arguments),Je.set(this,void 0)}_parse(e){let n=E.getValidEnumValues(this._def.values),r=this._getOrReturnCtx(e);if(r.parsedType!==y.string&&r.parsedType!==y.number){let a=E.objectValues(n);return h(r,{expected:E.joinValues(a),received:r.parsedType,code:f.invalid_type}),I}if(it(this,Je,"f")||vn(this,Je,new Set(E.getValidEnumValues(this._def.values)),"f"),!it(this,Je,"f").has(e.data)){let a=E.objectValues(n);return h(r,{received:r.data,code:f.invalid_enum_value,options:a}),I}return M(e.data)}get enum(){return this._def.values}};Je=new WeakMap;xe.create=(t,e)=>new xe({values:t,typeName:b.ZodNativeEnum,...v(e)});var ie=class extends S{unwrap(){return this._def.type}_parse(e){let{ctx:n}=this._processInputParams(e);if(n.parsedType!==y.promise&&n.common.async===!1)return h(n,{code:f.invalid_type,expected:y.promise,received:n.parsedType}),I;let r=n.parsedType===y.promise?n.data:Promise.resolve(n.data);return M(r.then(a=>this._def.type.parseAsync(a,{path:n.path,errorMap:n.common.contextualErrorMap})))}};ie.create=(t,e)=>new ie({type:t,typeName:b.ZodPromise,...v(e)});var j=class extends S{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===b.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(e){let{status:n,ctx:r}=this._processInputParams(e),a=this._def.effect||null,o={addIssue:i=>{h(r,i),i.fatal?n.abort():n.dirty()},get path(){return r.path}};if(o.addIssue=o.addIssue.bind(o),a.type==="preprocess"){let i=a.transform(r.data,o);if(r.common.async)return Promise.resolve(i).then(async s=>{if(n.value==="aborted")return I;let u=await this._def.schema._parseAsync({data:s,path:r.path,parent:r});return u.status==="aborted"?I:u.status==="dirty"||n.value==="dirty"?De(u.value):u});{if(n.value==="aborted")return I;let s=this._def.schema._parseSync({data:i,path:r.path,parent:r});return s.status==="aborted"?I:s.status==="dirty"||n.value==="dirty"?De(s.value):s}}if(a.type==="refinement"){let i=s=>{let u=a.refinement(s,o);if(r.common.async)return Promise.resolve(u);if(u instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return s};if(r.common.async===!1){let s=this._def.schema._parseSync({data:r.data,path:r.path,parent:r});return s.status==="aborted"?I:(s.status==="dirty"&&n.dirty(),i(s.value),{status:n.value,value:s.value})}else return this._def.schema._parseAsync({data:r.data,path:r.path,parent:r}).then(s=>s.status==="aborted"?I:(s.status==="dirty"&&n.dirty(),i(s.value).then(()=>({status:n.value,value:s.value}))))}if(a.type==="transform")if(r.common.async===!1){let i=this._def.schema._parseSync({data:r.data,path:r.path,parent:r});if(!me(i))return i;let s=a.transform(i.value,o);if(s instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:n.value,value:s}}else return this._def.schema._parseAsync({data:r.data,path:r.path,parent:r}).then(i=>me(i)?Promise.resolve(a.transform(i.value,o)).then(s=>({status:n.value,value:s})):i);E.assertNever(a)}};j.create=(t,e,n)=>new j({schema:t,typeName:b.ZodEffects,effect:e,...v(n)});j.createWithPreprocess=(t,e,n)=>new j({schema:e,effect:{type:"preprocess",transform:t},typeName:b.ZodEffects,...v(n)});var L=class extends S{_parse(e){return this._getType(e)===y.undefined?M(void 0):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}};L.create=(t,e)=>new L({innerType:t,typeName:b.ZodOptional,...v(e)});var W=class extends S{_parse(e){return this._getType(e)===y.null?M(null):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}};W.create=(t,e)=>new W({innerType:t,typeName:b.ZodNullable,...v(e)});var we=class extends S{_parse(e){let{ctx:n}=this._processInputParams(e),r=n.data;return n.parsedType===y.undefined&&(r=this._def.defaultValue()),this._def.innerType._parse({data:r,path:n.path,parent:n})}removeDefault(){return this._def.innerType}};we.create=(t,e)=>new we({innerType:t,typeName:b.ZodDefault,defaultValue:typeof e.default=="function"?e.default:()=>e.default,...v(e)});var Ce=class extends S{_parse(e){let{ctx:n}=this._processInputParams(e),r={...n,common:{...n.common,issues:[]}},a=this._def.innerType._parse({data:r.data,path:r.path,parent:{...r}});return He(a)?a.then(o=>({status:"valid",value:o.status==="valid"?o.value:this._def.catchValue({get error(){return new B(r.common.issues)},input:r.data})})):{status:"valid",value:a.status==="valid"?a.value:this._def.catchValue({get error(){return new B(r.common.issues)},input:r.data})}}removeCatch(){return this._def.innerType}};Ce.create=(t,e)=>new Ce({innerType:t,typeName:b.ZodCatch,catchValue:typeof e.catch=="function"?e.catch:()=>e.catch,...v(e)});var Be=class extends S{_parse(e){if(this._getType(e)!==y.nan){let r=this._getOrReturnCtx(e);return h(r,{code:f.invalid_type,expected:y.nan,received:r.parsedType}),I}return{status:"valid",value:e.data}}};Be.create=t=>new Be({typeName:b.ZodNaN,...v(t)});var la=Symbol("zod_brand"),Ke=class extends S{_parse(e){let{ctx:n}=this._processInputParams(e),r=n.data;return this._def.type._parse({data:r,path:n.path,parent:n})}unwrap(){return this._def.type}},Xe=class t extends S{_parse(e){let{status:n,ctx:r}=this._processInputParams(e);if(r.common.async)return(async()=>{let o=await this._def.in._parseAsync({data:r.data,path:r.path,parent:r});return o.status==="aborted"?I:o.status==="dirty"?(n.dirty(),De(o.value)):this._def.out._parseAsync({data:o.value,path:r.path,parent:r})})();{let a=this._def.in._parseSync({data:r.data,path:r.path,parent:r});return a.status==="aborted"?I:a.status==="dirty"?(n.dirty(),{status:"dirty",value:a.value}):this._def.out._parseSync({data:a.value,path:r.path,parent:r})}}static create(e,n){return new t({in:e,out:n,typeName:b.ZodPipeline})}},Ee=class extends S{_parse(e){let n=this._def.innerType._parse(e),r=a=>(me(a)&&(a.value=Object.freeze(a.value)),a);return He(n)?n.then(a=>r(a)):r(n)}unwrap(){return this._def.innerType}};Ee.create=(t,e)=>new Ee({innerType:t,typeName:b.ZodReadonly,...v(e)});function bn(t,e){let n=typeof t=="function"?t(e):typeof t=="string"?{message:t}:t;return typeof n=="string"?{message:n}:n}function En(t,e={},n){return t?oe.create().superRefine((r,a)=>{var o,i;let s=t(r);if(s instanceof Promise)return s.then(u=>{var c,d;if(!u){let l=bn(e,r),p=(d=(c=l.fatal)!==null&&c!==void 0?c:n)!==null&&d!==void 0?d:!0;a.addIssue({code:"custom",...l,fatal:p})}});if(!s){let u=bn(e,r),c=(i=(o=u.fatal)!==null&&o!==void 0?o:n)!==null&&i!==void 0?i:!0;a.addIssue({code:"custom",...u,fatal:c})}}):oe.create()}var ma={object:V.lazycreate},b;(function(t){t.ZodString="ZodString",t.ZodNumber="ZodNumber",t.ZodNaN="ZodNaN",t.ZodBigInt="ZodBigInt",t.ZodBoolean="ZodBoolean",t.ZodDate="ZodDate",t.ZodSymbol="ZodSymbol",t.ZodUndefined="ZodUndefined",t.ZodNull="ZodNull",t.ZodAny="ZodAny",t.ZodUnknown="ZodUnknown",t.ZodNever="ZodNever",t.ZodVoid="ZodVoid",t.ZodArray="ZodArray",t.ZodObject="ZodObject",t.ZodUnion="ZodUnion",t.ZodDiscriminatedUnion="ZodDiscriminatedUnion",t.ZodIntersection="ZodIntersection",t.ZodTuple="ZodTuple",t.ZodRecord="ZodRecord",t.ZodMap="ZodMap",t.ZodSet="ZodSet",t.ZodFunction="ZodFunction",t.ZodLazy="ZodLazy",t.ZodLiteral="ZodLiteral",t.ZodEnum="ZodEnum",t.ZodEffects="ZodEffects",t.ZodNativeEnum="ZodNativeEnum",t.ZodOptional="ZodOptional",t.ZodNullable="ZodNullable",t.ZodDefault="ZodDefault",t.ZodCatch="ZodCatch",t.ZodPromise="ZodPromise",t.ZodBranded="ZodBranded",t.ZodPipeline="ZodPipeline",t.ZodReadonly="ZodReadonly"})(b||(b={}));var fa=(t,e={message:`Input not instance of ${t.name}`})=>En(n=>n instanceof t,e),Tn=ae.create,Nn=fe.create,pa=Be.create,ha=pe.create,Rn=he.create,ya=ye.create,ga=ze.create,_a=ge.create,ba=_e.create,Ia=oe.create,ka=Y.create,va=q.create,Sa=Me.create,xa=Q.create,wa=V.create,Ca=V.strictCreate,Ea=be.create,Ta=st.create,Na=Ie.create,Ra=G.create,Oa=ct.create,Aa=$e.create,Da=Ve.create,Pa=ut.create,za=ke.create,Ma=ve.create,$a=Se.create,Va=xe.create,Ba=ie.create,In=j.create,ja=L.create,La=W.create,Fa=j.createWithPreprocess,Za=Xe.create,qa=()=>Tn().optional(),Ua=()=>Nn().optional(),Ga=()=>Rn().optional(),Wa={string:t=>ae.create({...t,coerce:!0}),number:t=>fe.create({...t,coerce:!0}),boolean:t=>he.create({...t,coerce:!0}),bigint:t=>pe.create({...t,coerce:!0}),date:t=>ye.create({...t,coerce:!0})},Ja=I,R=Object.freeze({__proto__:null,defaultErrorMap:Pe,setErrorMap:Fr,getErrorMap:at,makeIssue:ot,EMPTY_PATH:Zr,addIssueToContext:h,ParseStatus:P,INVALID:I,DIRTY:De,OK:M,isAborted:Pt,isDirty:zt,isValid:me,isAsync:He,get util(){return E},get objectUtil(){return Dt},ZodParsedType:y,getParsedType:X,ZodType:S,datetimeRegex:wn,ZodString:ae,ZodNumber:fe,ZodBigInt:pe,ZodBoolean:he,ZodDate:ye,ZodSymbol:ze,ZodUndefined:ge,ZodNull:_e,ZodAny:oe,ZodUnknown:Y,ZodNever:q,ZodVoid:Me,ZodArray:Q,ZodObject:V,ZodUnion:be,ZodDiscriminatedUnion:st,ZodIntersection:Ie,ZodTuple:G,ZodRecord:ct,ZodMap:$e,ZodSet:Ve,ZodFunction:ut,ZodLazy:ke,ZodLiteral:ve,ZodEnum:Se,ZodNativeEnum:xe,ZodPromise:ie,ZodEffects:j,ZodTransformer:j,ZodOptional:L,ZodNullable:W,ZodDefault:we,ZodCatch:Ce,ZodNaN:Be,BRAND:la,ZodBranded:Ke,ZodPipeline:Xe,ZodReadonly:Ee,custom:En,Schema:S,ZodSchema:S,late:ma,get ZodFirstPartyTypeKind(){return b},coerce:Wa,any:Ia,array:xa,bigint:ha,boolean:Rn,date:ya,discriminatedUnion:Ta,effect:In,enum:$a,function:Pa,instanceof:fa,intersection:Na,lazy:za,literal:Ma,map:Aa,nan:pa,nativeEnum:Va,never:va,null:ba,nullable:La,number:Nn,object:wa,oboolean:Ga,onumber:Ua,optional:ja,ostring:qa,pipeline:Za,preprocess:Fa,promise:Ba,record:Oa,set:Da,strictObject:Ca,string:Tn,symbol:ga,transformer:In,tuple:Ra,undefined:_a,union:Ea,unknown:ka,void:Sa,NEVER:Ja,ZodIssueCode:f,quotelessJson:Lr,ZodError:B});var $t=class{constructor(){this.logLevel=1;this.activeChannels=new Set(["Always","Terminal","Storage","Network","AutoCrafting"])}debug(e,n="Always",...r){1<this.logLevel||!this.activeChannels.has(n)||console.log(`\xA7f ${n!=="Always"?`[${n}] `:" "}${e}`,...r)}info(e,n="Always",...r){2<this.logLevel||!this.activeChannels.has(n)||console.log(`\xA7s ${n!=="Always"?`[${n}] `:" "}${e}`,...r)}warn(e,n="Always",...r){3<this.logLevel||!this.activeChannels.has(n)||console.warn(`\xA7e ${n!=="Always"?`[${n}] `:" "}${e}`,...r)}error(e,n="Always",...r){4<this.logLevel||!this.activeChannels.has(n)||console.error(`\xA7c ${n!=="Always"?`[${n}] `:" "}${e}`,...r)}},x=new $t;function dt(t,e,n){return Math.min(Math.max(t,e),n)}var N=class t{static equals(e,n){return e.x===n.x&&e.y===n.y&&e.z===n.z}static add(e,n){return{x:e.x+n.x,y:e.y+n.y,z:e.z+n.z}}static subtract(e,n){return{x:e.x-n.x,y:e.y-n.y,z:e.z-n.z}}static scale(e,n){return{x:e.x*n,y:e.y*n,z:e.z*n}}static dot(e,n){return e.x*n.x+e.y*n.y+e.z*n.z}static cross(e,n){return{x:e.y*n.z-e.z*n.y,y:e.z*n.x-e.x*n.z,z:e.x*n.y-e.y*n.x}}static magnitude(e){return Math.sqrt(e.x**2+e.y**2+e.z**2)}static distance(e,n){return t.magnitude(t.subtract(e,n))}static normalize(e){let n=t.magnitude(e);return{x:e.x/n,y:e.y/n,z:e.z/n}}static floor(e){return{x:Math.floor(e.x),y:Math.floor(e.y),z:Math.floor(e.z)}}static toString(e,n){let r=n?.decimals??2;return[e.x.toFixed(r),e.y.toFixed(r),e.z.toFixed(r)].join(n?.delimiter??", ")}static clamp(e,n){return{x:dt(e.x,n?.min?.x??Number.MIN_SAFE_INTEGER,n?.max?.x??Number.MAX_SAFE_INTEGER),y:dt(e.y,n?.min?.y??Number.MIN_SAFE_INTEGER,n?.max?.y??Number.MAX_SAFE_INTEGER),z:dt(e.z,n?.min?.z??Number.MIN_SAFE_INTEGER,n?.max?.z??Number.MAX_SAFE_INTEGER)}}static lerp(e,n,r){return{x:e.x+(n.x-e.x)*r,y:e.y+(n.y-e.y)*r,z:e.z+(n.z-e.z)*r}}static slerp(e,n,r){let a=Math.acos(t.dot(e,n)),o=Math.sin(a),i=Math.sin((1-r)*a)/o,s=Math.sin(r*a)/o;return t.add(t.scale(e,i),t.scale(n,s))}static multiply(e,n){return{x:e.x*n.x,y:e.y*n.y,z:e.z*n.z}}static rotateX(e,n){let r=Math.cos(n),a=Math.sin(n);return{x:e.x,y:e.y*r-e.z*a,z:e.z*r+e.y*a}}static rotateY(e,n){let r=Math.cos(n),a=Math.sin(n);return{x:e.x*r+e.z*a,y:e.y,z:e.z*r-e.x*a}}static rotateZ(e,n){let r=Math.cos(n),a=Math.sin(n);return{x:e.x*r-e.y*a,y:e.y*r+e.x*a,z:e.z}}};var lt={x:0,y:1,z:0},mt={x:0,y:-1,z:0},ft={x:-1,y:0,z:0},pt={x:1,y:0,z:0},ht={x:0,y:0,z:1},yt={x:0,y:0,z:-1};var Vt={x:0,y:0,z:0};var ee={up:lt,down:mt,north:yt,south:ht,east:pt,west:ft},Bt={north:"south",east:"west",south:"north",west:"east",up:"down",down:"up",north_east:"south_west",east_south:"west_north",south_west:"north_east",west_north:"east_south"};var gt=[Vt,lt,mt,ft,pt,ht,yt],Ha={"ae2be:north":ht,"ae2be:south":yt,"ae2be:west":ft,"ae2be:east":pt,"ae2be:up":lt,"ae2be:down":mt,"ae2be:zero":Vt},jt=Object.entries(Ha),On=Object.entries(ee).reduce((t,[e,n])=>(t[e]=N.scale(n,-.1),t),{});var Lt=3,Ka={"ae2be:1k_crafting_cpu":{craftingStorage:1024,parallelTasks:0},"ae2be:4k_crafting_cpu":{craftingStorage:4096,parallelTasks:0},"ae2be:16k_crafting_cpu":{craftingStorage:16384,parallelTasks:0},"ae2be:32k_crafting_cpu":{craftingStorage:32768,parallelTasks:0},"ae2be:co_processor":{craftingStorage:0,parallelTasks:1}};function Xa({boundBlock:t}){if(!t)return;let e=new Set,n=[t.location],r=[];for(;n.length>0;){let w=n.shift(),D=`${w.x},${w.y},${w.z}`;if(e.has(D))continue;e.add(D);let $=t.dimension.getBlock(w);if(!(!$||!$.hasTag("ae2be:crafting_cpu"))){r.push($);for(let le of gt){let U=N.add(w,le);e.has(`${U.x},${U.y},${U.z}`)||n.push(U)}}}if(r.length===0)return;let a=1/0,o=-1/0,i=1/0,s=-1/0,u=1/0,c=-1/0,d=new Set,l=new Set,p=new Set;for(let w of r)a=Math.min(a,w.x),o=Math.max(o,w.x),i=Math.min(i,w.y),s=Math.max(s,w.y),u=Math.min(u,w.z),c=Math.max(c,w.z),d.add(w.x),l.add(w.y),p.add(w.z);let m=d.size,g=l.size,k=p.size;if(m>Lt||g>Lt||k>Lt)return;let C=m*g*k;if(r.length!==C)return;for(let w=a;w<=o;w++)for(let D=i;D<=s;D++)for(let $=u;$<=c;$++)if(!r.some(U=>U.x===w&&U.y===D&&U.z===$))return;let A=1,T=0;for(let w of r){let D=Ka[w.typeId];D&&(A+=D.parallelTasks,T+=D.craftingStorage)}return{startLocation:{x:a,y:i,z:u},endLocation:{x:o,y:s,z:c},width:m,height:g,depth:k,pararellTaskCount:A,totalCraftingStorage:T}}function Ya(t){let{alreadyIndexedCPUS:e,boundBlock:n}=t;if(!n||e.some(i=>i.startLocation.x<=n.x&&i.endLocation.x>=n.x&&i.startLocation.y<=n.y&&i.endLocation.y>=n.y&&i.startLocation.z<=n.z&&i.endLocation.z>=n.z))return;let a=Xa(t);if(!a)return;if(e.some(i=>i.startLocation.x<=a.endLocation.x&&i.endLocation.x>=a.startLocation.x&&i.startLocation.y<=a.endLocation.y&&i.endLocation.y>=a.startLocation.y&&i.startLocation.z<=a.endLocation.z&&i.endLocation.z>=a.startLocation.z)){x.warn("Overlapping CPUs detected, skipping","AutoCrafting");return}return a}var An={typeId:"ae2be:1k_crafting_cpu",consumesChannels:1,isBlockEntity:!1,eventPriority:0,provideCraftingCpuToNetwork:Ya};import{DyeColor as ai}from"@minecraft/server";import{BlockPermutation as io}from"@minecraft/server";import{ItemStack as ro}from"@minecraft/server";import{ContainerSlot as Qa,EnchantmentTypes as eo,ItemStack as to}from"@minecraft/server";function z(t){t instanceof Qa&&(t=t.getItem());let e={typeId:t.typeId,nameTag:t.nameTag,amount:t.amount,lore:void 0,placeOnBlocks:void 0,dynamicProperties:void 0},n=t.getLore();n.length>0&&(e.lore=n);let r=t.getCanPlaceOn();r.length>0&&(e.placeOnBlocks=r);let a=t.getDynamicPropertyIds();a.length>0&&(e.dynamicProperties=a.map(s=>({id:s,value:t.getDynamicProperty(s)})));let o=t.getComponent("durability");o&&(e.damage=o.damage);let i=t.getComponent("enchantable");return i&&(e.enchantments=i.getEnchantments().map(s=>({type:s.type.id,level:s.level}))),e}function te(t){let e=new to(t.typeId,t.amount);e.nameTag=t.nameTag,e.setLore(t.lore),t.dynamicProperties?.forEach(a=>{e.setDynamicProperty(a.id,a.value)});let n=e.getComponent("durability");n&&t.damage&&(n.damage=t.damage),e.setCanPlaceOn(t.placeOnBlocks);let r=e.getComponent("enchantable");return r&&t.enchantments&&t.enchantments.forEach(a=>{r.addEnchantment({type:eo.get(a.type),level:a.level})}),e}function O(t){let e=t.enchantments?.map(r=>`${r.type.split(":",2)[1]}${r.level}`).join(",")??"";return`${t.typeId};${t.nameTag??""}${t.lore?.join(",")??""}${e}${t.damage??""}`}var Dn={typeId:"ae2be:1k_storage_cell",byteSize:1024,itemTypesSize:16},Pn={typeId:"ae2be:4k_storage_cell",byteSize:4096,itemTypesSize:32},zn={typeId:"ae2be:16k_storage_cell",byteSize:16384,itemTypesSize:64},Mn={typeId:"ae2be:32k_storage_cell",byteSize:32768,itemTypesSize:64};import{ContainerSlot as no,world as $n}from"@minecraft/server";function Ft(t,e){switch(e){case"up":return{...t,"ae2be:north":t["ae2be:up"],"ae2be:south":t["ae2be:down"],"ae2be:west":t["ae2be:west"],"ae2be:east":t["ae2be:east"],"ae2be:up":t["ae2be:south"],"ae2be:down":t["ae2be:north"]};case"down":return{...t,"ae2be:north":t["ae2be:down"],"ae2be:south":t["ae2be:up"],"ae2be:west":t["ae2be:west"],"ae2be:east":t["ae2be:east"],"ae2be:up":t["ae2be:north"],"ae2be:down":t["ae2be:south"]};case"north":return{...t,"ae2be:north":t["ae2be:north"],"ae2be:south":t["ae2be:south"],"ae2be:west":t["ae2be:west"],"ae2be:east":t["ae2be:east"],"ae2be:up":t["ae2be:up"],"ae2be:down":t["ae2be:down"]};case"south":return{...t,"ae2be:north":t["ae2be:south"],"ae2be:south":t["ae2be:north"],"ae2be:west":t["ae2be:east"],"ae2be:east":t["ae2be:west"],"ae2be:up":t["ae2be:up"],"ae2be:down":t["ae2be:down"]};case"east":return{...t,"ae2be:up":t["ae2be:up"],"ae2be:down":t["ae2be:down"],"ae2be:north":t["ae2be:west"],"ae2be:south":t["ae2be:east"],"ae2be:west":t["ae2be:north"],"ae2be:east":t["ae2be:south"]};case"west":return{...t,"ae2be:up":t["ae2be:up"],"ae2be:down":t["ae2be:down"],"ae2be:north":t["ae2be:east"],"ae2be:south":t["ae2be:west"],"ae2be:west":t["ae2be:south"],"ae2be:east":t["ae2be:north"]}}}var Te=["overworld","nether","the_end"].map(t=>$n.getDimension(t));function J(t){return t.amount>1?t.amount--:t.setItem(),t}function Vn(t,e){if(!t||t instanceof no&&!t.hasItem())return;let n=t.getDynamicProperty("ae2be:patternItems"),r=t.getDynamicProperty("ae2be:resultItems");if(!(!n||!r))try{let a=JSON.parse(n),o=JSON.parse(r);return{patternType:"processing",patternItems:a,resultItems:o,interfaceEntity:e}}catch{x.error("Failed to parse pattern from item","Storage")}}function je(t,e){let n=t.split(";",2)[0];return Object.assign({typeId:n},e.itemTemplate)}function Zt(t,e){return Ft(t,e)}function Bn([t]){let e=$n.structureManager.get(t);if(!e)throw new ReferenceError(`Structure ${t} Does Not Exist`);return e}function Ne(t,e){return!e||e?.amount!==t.amount||e?.typeId!==t.typeId}function jn(t){if(t<999999)return t.toString();let e=["","k","M","G","T","P","E","Z","Y"],n=0;for(;t>=1e3&&n<e.length-1;)t/=1e3,n++;return t.toFixed(2)+e[n]}var ao=[Dn,Pn,zn,Mn];function Ln(t){let e=ao.find(n=>n.typeId===t.typeId);if(!e)throw new Error(`No storage cell found for item ${t.typeId}`);return oo(e).bind(t)}function oo(t){let e=t.byteSize;return{storageInformation:t,boundSlot:void 0,itemStorage:{},getItemStorageClone(){return{...this.itemStorage}},setItemStorage(n){this.itemStorage=n,this.boundSlot&&this.boundSlot.isValid()&&this.boundSlot.setItem(this.getStorageDiskItemStack())},bind(n){this.boundSlot=n;try{let r=n.getDynamicProperty("ae2be:itemStorage");return r?(this.itemStorage=JSON.parse(r),this):this}catch(r){return x.error("Failed to load storage cell","Storage",r),this}},serializeStorage(){return JSON.stringify(this.itemStorage)},getByteUsage(n){let r=n||this.itemStorage,a=JSON.stringify(r).length,o=~~(Object.values(r).reduce((i,{amount:s})=>i+s,0)/8);return a+o},unTemplate:je,tryAddItemStack(n){let r=z(n),a=O(r);delete r.amount,delete r.typeId;let o=this.getItemStorageClone(),i=o[a]||{amount:0,itemTemplate:r};if(i.amount+=n.amount,o[a]=i,this.getByteUsage(o)>e||Object.keys(o).length>this.storageInformation.itemTypesSize)return n;this.setItemStorage(o)},getStorageDiskItemStack(){let n=new ro(this.storageInformation.typeId),r=n.nameTag??n.typeId;return r=r.split(":")[1],r=r.replace(/_/g," "),r=r.replace(/\b\w/g,a=>a.toUpperCase()),n.nameTag="\xA7r\xA7f"+r,n.setDynamicProperty("ae2be:itemStorage",this.serializeStorage()),n.setLore([" \xA7r\xA78Bytes:",`  \xA7r\xA7e${this.getByteUsage()}\xA77/${e}`," \xA7r\xA78Types:",`  \xA7r\xA7e${Object.keys(this.itemStorage).length}\xA77/${this.storageInformation.itemTypesSize}`]),n}}}var so=(t,e,n)=>Math.max(e,Math.min(n,t)),qt={typeId:"ae2be:disk_drive",consumesChannels:1,isBlockEntity:!0,blockEntityContainerName:"disk_drive.entity.ui",onceConnected({boundEntity:t}){t&&(t.nameTag=this.blockEntityContainerName)},provideDisksToNetwork({boundEntity:t,boundBlock:e}){if(!e||e.isAir||!t)return[];let n=t.getComponent("inventory")?.container;if(!n)return[];let r=[],a={"ae2be:disk_0":!1,"ae2be:disk_1":!1,"ae2be:disk_2":!1,"ae2be:disk_3":!1};for(let i=0;i<n.size;i++){let s=n.getSlot(i);s.hasItem()&&s.hasTag("ae2be:storage_cell")&&(r.push(Ln(s)),a[`ae2be:disk_${so(i,0,3)}`]=!0)}let o=io.resolve(e.typeId,{...e.permutation.getAllStates(),...a});return e.setPermutation(o),r}};var Ut={typeId:"ae2be:energy_acceptor",consumesChannels:0,isBlockEntity:!1};import{ItemStack as Gt}from"@minecraft/server";import{EntityComponentTypes as Fn}from"@minecraft/server";var Zn=["dorios:machine","dorios:generator"];function qn(t){let e=t.getComponent(Fn.TypeFamily);if(!e?.hasTypeFamily("dorios:machine")&&!e?.hasTypeFamily("dorios:generator"))return;let n=t.getComponent(Fn.Inventory)?.container;if(!n)return;let r=new Set,a=new Set,o=0;if((e.hasTypeFamily("dorios:simple_input")||e.hasTypeFamily("dorios:simple_container"))&&r.add(3),e.hasTypeFamily("dorios:simple_output")&&(a.add(n.size-1),o=1),e.hasTypeFamily("dorios:complex_output")||e.hasTypeFamily("dorios:3x3_output")){for(let i=n.size-9;i<n.size;i++)a.add(i-1);o=9}if(e.hasTypeFamily("dorios:complex_input"))for(let i=0;i<9;i++)r.add(n.size-1-o-9+i);return{typeId:t.typeId,containerType:"entity",container:{inputSlots:Array.from(r),outputSlots:Array.from(a)}}}import{Entity as co}from"@minecraft/server";var Un=Array.from({length:5},(t,e)=>e),Gn=Array.from({length:27},(t,e)=>e),Wn={inputSlots:Gn,outputSlots:Gn,insertsItems:!1},uo={inputSlots:Un,outputSlots:Un,insertsItems:!0},_t=new Map([["minecraft:hopper",{typeId:"minecraft:hopper",containerType:"block",container:uo}],["minecraft:chest",{typeId:"minecraft:chest",containerType:"block",container:Wn}],["minecraft:barrel",{typeId:"minecraft:barrel",containerType:"block",container:Wn}]]),Os=[...Zn],H={get(t){let{typeId:e}=t;if(_t.has(e))return _t.get(e);let n=t instanceof co;switch(!0){case(n&&e.startsWith("twm:")):x.info(`Loading TWM Integration for ${e}...`);let r=qn(t);if(!r){x.error(`Failed to load TWM Integration for ${e}, no registry found.`);return}return _t.set(e,r),r}},set(t,e){_t.set(t,e)}};var lo={typeId:"ae2be:silicon",amount:1,maxAmount:64,consumes:!0},bt={typeId:"minecraft:iron_ingot",amount:1,maxAmount:64,consumes:!0},mo={typeId:"minecraft:gold_ingot",amount:1,maxAmount:64,consumes:!0},fo={typeId:"minecraft:diamond",amount:1,maxAmount:64,consumes:!0},Wt={typeId:"minecraft:redstone",amount:1,maxAmount:64,consumes:!0},Jt={typeId:"ae2be:silicon_press",amount:1,maxAmount:64,consumes:!1},Ht={typeId:"ae2be:logic_processor_press",amount:1,maxAmount:64,consumes:!1},Kt={typeId:"ae2be:engineering_processor_press",amount:1,maxAmount:64,consumes:!1},It={typeId:"ae2be:calculation_processor_press",amount:1,maxAmount:64,consumes:!1},po={typeId:"ae2be:logic_processor",amount:1,maxAmount:64,consumes:!0},ho={typeId:"ae2be:engineering_processor",amount:1,maxAmount:64,consumes:!0},yo={typeId:"ae2be:calculation_processor",amount:1,maxAmount:64,consumes:!0},kt={typeId:"ae2be:silicon_print",amount:1,maxAmount:64,consumes:!0},Jn={typeId:"ae2be:engineering_processor_print",amount:1,maxAmount:64,consumes:!0},Xt={typeId:"ae2be:calculation_processor_print",amount:1,maxAmount:64,consumes:!0},Hn={typeId:"ae2be:logic_processor_print",amount:1,maxAmount:64,consumes:!0},go={typeId:"ae2be:certus_quartz_crystal",amount:1,maxAmount:64,consumes:!0},_o={typeId:"ae2be:charged_certus_quartz_crystal",amount:1,maxAmount:64,consumes:!0};function Kn(t){return t.map(e=>e.typeId).sort().join(";")}var bo=[{inputs:[Jt,bt],outputs:Jt},{inputs:[Jt,lo],outputs:kt},{inputs:[Ht,bt],outputs:Ht},{inputs:[Ht,mo],outputs:Hn},{inputs:[Hn,Wt,kt],outputs:po},{inputs:[Kt,bt],outputs:Kt},{inputs:[Kt,fo],outputs:Jn},{inputs:[Jn,Wt,kt],outputs:ho},{inputs:[It,bt],outputs:It},{inputs:[It,go],outputs:Xt},{inputs:[It,_o],outputs:Xt},{inputs:[Xt,Wt,kt],outputs:yo}],Io=bo.reduce((t,e)=>{let n=Kn(e.inputs);return t[n]=e,t},{}),Yt={typeId:"ae2be:inscriber",consumesChannels:0,isBlockEntity:!0,blockEntityContainerName:"inscriber.entity.ui",onceConnected({boundEntity:t}){if(!t||!t.isValid())return;t.getComponent("inventory").container.setItem(4,new Gt("ae2be:ui_progress"))},tick({boundBlock:t,network:e,boundEntity:n}){if(!n||!n.isValid())return;let r=n.getComponent("inventory").container,a=[r.getSlot(0),r.getSlot(1),r.getSlot(2)].filter(c=>c.hasItem()),o=r.getSlot(3),i=Kn(a),s=Io[i];function u(c){if(!n||!n.isValid())return;n.setDynamicProperty("ae2be:progress",c);let d=Math.min(Math.max(1,Math.floor(64*(c/100))),64);r.getSlot(4).setItem(new Gt("ae2be:ui_progress",d))}if(s&&(!o.hasItem()||s.outputs.typeId===o.typeId&&s.outputs.maxAmount>o.amount)){let c=n.getDynamicProperty("ae2be:progress")??0;c>=100?(a.forEach(d=>{let l=s.inputs.find(p=>p.typeId===d.typeId);!l||!l.consumes||J(d)}),o.hasItem()?o.amount+=s.outputs.amount:o.setItem(new Gt(s.outputs.typeId,s.outputs.amount)),u(0)):u(c+1)}else u(0)}};H.set("ae2be:inscriber",{typeId:"ae2be:inscriber",containerType:"entity",container:{inputSlots:[0,1,2],outputSlots:[3]}});import{system as ko}from"@minecraft/server";function vt(t){return{getExpectedItemOutputs(){let e=t.getDynamicProperty("ae2be:interface_output");if(!e)return{};try{return JSON.parse(e)}catch{return x.error(`Failed to parse output string: ${e}`,"AutoCrafting"),{}}},getExpectedItemInputs(){let e=t.getDynamicProperty("ae2be:interface_input");if(!e)return{};try{return JSON.parse(e)}catch{return x.error(`Failed to parse input string: ${e}`,"AutoCrafting"),{}}},addItemsToOutput(e){console.warn("addItemsToOutput",e.map(r=>r.amount));let n=this.getExpectedItemOutputs();for(let r of e){let a=O(r);n[a]||(n[a]={...r},n[a].amount=0),n[a].amount+=r.amount,n[a].amount<=0&&delete n[a]}console.warn("output",JSON.stringify(n)),t.setDynamicProperty("ae2be:interface_output",JSON.stringify(n))},addItemsToInput(e){console.warn("addItemsToInput",e.map(r=>r.amount));let n=this.getExpectedItemInputs();for(let r of e){let a=O(r);n[a]||(n[a]={...r},n[a].amount=0),n[a].amount+=r.amount,n[a].amount<=0&&delete n[a]}t.setDynamicProperty("ae2be:interface_input",JSON.stringify(n))}}}var Le={typeId:"ae2be:interface",consumesChannels:1,isBlockEntity:!0,blockEntityContainerName:"interface.entity.ui",providePattersToNetwork({boundEntity:t}){if(!t)return[];let e=t.getComponent("inventory")?.container;return Array.from({length:9},(a,o)=>e.getSlot(o+16)).map(a=>Vn(a,t)).filter(a=>!!a)},tick({boundEntity:t,boundBlock:e,network:n}){if(!t||!e||ko.currentTick%2!==0)return;let r=t?.getComponent("inventory")?.container;if(!r)return;let a=Array.from({length:8},(d,l)=>r.getSlot(l)),o=Array.from({length:8},(d,l)=>r.getSlot(l+8)),i=vt(t);a.forEach((d,l)=>{if(!d.hasItem())return;let p=n.mayAddItemToNetwork(d,{});Ne(d,p)&&d.setItem(p)});let s=e.above().getComponent("inventory")?.container,u=e.below().getComponent("inventory")?.container;if(u){let d=Object.entries(i.getExpectedItemOutputs())?.[0]?.[1];d&&(console.log(`Next: ${d.typeId}`),u.addItem(te(d)),d.amount=-d.amount,i.addItemsToOutput([d]))}if(s){let d=function(){for(let p=0;p<s.size;p++){let m=s.getSlot(p);if(m.hasItem())return m}};var c=d;let l=d();if(l){let p=n.mayAddItemToNetwork(l,{}),m=z(l);m.amount=-m.amount,i.addItemsToInput([m]),Ne(l,p)&&l.setItem(p)}}}};H.set("ae2be:interface",{typeId:"ae2be:interface",containerType:"entity",container:{inputSlots:[0,1,2,3,4,5,6,7],outputSlots:[8,9,10,11,12,13,14,15]}});var Qt={typeId:"ae2be:network_cable",consumesChannels:0,isBlockEntity:!1};import{ItemStack as Xn,system as St,world as vo}from"@minecraft/server";var So="ae2be:blank_pattern",xo="ae2be:encoded_pattern",en=new Xn("ae2be:encode_pattern_ui_action"),tn={typeId:"ae2be:pattern_terminal",consumesChannels:1,isBlockEntity:!0,blockEntityContainerName:"pattern_terminal.entity.ui",onceConnected({boundEntity:t}){t.getComponent("inventory").container.getSlot(15).setItem(en)},tick({boundEntity:t}){if(!t||St.currentTick%5!==0)return;let e=t.getComponent("inventory").container,n=e.getSlot(15);if(!n.hasItem()){let r=e.getSlot(13),a=e.getSlot(14);r.hasItem()&&r.typeId===So&&!a.hasItem()&&St.run(()=>{J(r);function o(c){return c.hasItem()?z(c.getItem()):null}let i=Array.from({length:9},(c,d)=>e.getSlot(d)).map(o),s=Array.from({length:3},(c,d)=>e.getSlot(d+9)).map(o),u=new Xn(xo);u.nameTag=s.map(c=>c?.typeId).join(", "),u.setLore(i.map(c=>c?.typeId).filter(c=>!!c)),u.setDynamicProperty("ae2be:patternItems",JSON.stringify(i)),u.setDynamicProperty("ae2be:resultItems",JSON.stringify(s)),a.setItem(u)}),St.run(()=>{n.setItem(en)})}}};St.runInterval(()=>{for(let t of vo.getAllPlayers()){let e=t.getComponent("cursor_inventory"),n=e.item;n&&n.typeId===en.typeId&&e.clear()}},5);import{ItemStack as wo,system as Yn,world as Co}from"@minecraft/server";function Eo(t,e){if(!(t.resultItems[1]||t.resultItems[0]||t.resultItems[2]))return;let r=new wo("ae2be:encoded_pattern");return r.setDynamicProperty("ae2be:pattern",JSON.stringify(t)),r.setDynamicProperty("ae2be:boundEntityLocation",e),r}function To({boundEntity:t,patterns:e}){if(!t||!t.isValid())return;let n=t.getComponent("inventory").container;n.clearAll();for(let r=0;r<Math.min(e.length,n.size);r++){let a=n.getSlot(r),o=Eo(e[r],t.location);a.setItem(o)}}function No(t,e){let n=t.getDynamicProperty("ae2be:pattern");if(!n)return;let r=t.getDynamicProperty("ae2be:boundEntityLocation");if(!r)return;let a=e.getEntitiesAtBlockLocation(r)[0];if(a)try{return{pattern:JSON.parse(n),boundEntity:a,network:a.ae2Network}}catch{return}}function Ro(t){return{patternType:"processing",patternItems:t.patternItems,resultItems:t.resultItems}}var nn={typeId:"ae2be:request_terminal",consumesChannels:1,isBlockEntity:!0,blockEntityContainerName:"terminal.entity.ui",tick({boundEntity:t,network:e}){if(!t||Yn.currentTick%20!==0)return;let n=e.getPatterns().map(Ro),r=t.getComponent("inventory").container,a=[];To({boundEntity:t,patterns:n})}};Yn.runInterval(()=>{for(let t of Co.getAllPlayers()){let e=t.getComponent("cursor_inventory"),n=e.item;if(n){let r=No(n,t.dimension);if(!r||!r.network)continue;r.network.createPatternRequest(O(r.pattern.resultItems[1]),4).start(),e.clear()}}},5);import{system as Qo}from"@minecraft/server";import{EntityComponentTypes as Nt,system as Wo,world as ln}from"@minecraft/server";function Fe(t){return t.reduce((e,n)=>(Object.entries(n.itemStorage).forEach(([r,a])=>{let o=n.unTemplate(r,a);a.itemTemplate=o,e[r]?e[r].amount+=a.amount:e[r]=a}),e),{})}import{ContainerSlot as tr,system as rn}from"@minecraft/server";import{world as Oo}from"@minecraft/server";function Qn(){let t=this,e=[];return t.getNetworkDevices().forEach(n=>{let r=n.provideCraftingCpuToNetwork?.({network:t,alreadyIndexedCPUS:e,...n});r&&e.push(r)}),e}function er(t,e){let n=this;x.info(`Creating pattern request for ${e}x ${t}`,"AutoCrafting");let r=n.getPatterns(),a=Fe(n.getStorageCells()),o=r.find(u=>u.resultItems.some(c=>c&&O(c)===t));if(!o)throw new Error("Pattern Not Found");function i(u,c,d){let l=u.resultItems.find(g=>g&&O(g)===c);if(!l)return;let p=Math.ceil(d/l.amount),m=u.patternItems.reduce((g,k)=>{if(!k)return g;let C=O(k);return g[C]||(g[C]??={},g[C].item={...k},g[C].item.amount=0,g[C].interfaceEntityId=u.interfaceEntity.id),g[C].item.amount+=k.amount*p,g},{});return Object.entries(m).forEach(([g,k])=>{if(!k)return;let C=r.find(A=>A.resultItems.some(T=>T&&O(T)===g));C&&(m[g]??={},m[g].madeOf=i(C,g,k.item.amount))}),m}let s=i(o,t,e);return console.log(JSON.stringify(s,null,2)),{canStart:!0,requestSummary:{tree:s},start(){let u=Object.values(s);for(;u.length>0;){let c=u.shift(),d=Oo.getEntity(c.interfaceEntityId);if(!d){x.error(`Interface Entity ${c.interfaceEntityId} not found`,"AutoCrafting");return}let l=vt(d);if(l.addItemsToInput([c.item]),c.madeOf){let p=Object.values(c.madeOf);u.push(...p),l.addItemsToOutput(p.map(m=>m.item))}}}}}var xt=new Map,nr=0;function rr(t){if(nr>999999)throw new Error("The max amount of networks has been reached");let e=[],n=!0,r=(nr++).toString().padStart(6,"0");return new class{constructor(){this.dynamicNetworkEntity=new Map;this.networkId=r;this.networkDevices=t.filter(a=>a.boundBlock?.hasTag("ae2be:network_events")).sort((a,o)=>(a.eventPriority??1/0)-(o.eventPriority??1/0));this.createPatternRequest=er.bind(this);this.getCraftingCpus=Qn.bind(this);xt.set(r,this),this.initialize()}getNetworkDevices(){return[...this.networkDevices,...this.dynamicNetworkEntity.values()]}initialize(){for(let a of this.getNetworkDevices())a.boundEntity&&(a.boundEntity.ae2Network?.dispose(),a.boundEntity.ae2Network=this,a.boundEntity.setDynamicProperty("ae2be:lastNetworkId",r)),a.onceConnected?.({boundBlock:a.boundBlock,boundEntity:a.boundEntity,network:this});this.intervalId=rn.runInterval(()=>{if(!n){this.intervalId&&rn.clearRun(this.intervalId);return}let a=this.getStorageCells(),o=JSON.stringify(a)!==JSON.stringify(e);o&&(e=a,x.info("Storage updated","Storage"));for(let i of this.getNetworkDevices())o&&i.onStorageUpdate?.({boundBlock:i.boundBlock,boundEntity:i.boundEntity,network:this}),i.tick?.({boundBlock:i.boundBlock,boundEntity:i.boundEntity,network:this})})}mayAddItemToNetwork(a,{supressEvent:o=!1}){if(Ze.has(a.typeId))return a instanceof tr?a.getItem():a;let i=a instanceof tr?a.getItem():a,s=this.getStorageCells();for(let u of s){let c=u.tryAddItemStack(a,{});if(c?.amount!==i?.amount){if(x.info(`Added ${a.amount-(c?.amount??0)}x ${a.typeId} to network`,"Storage"),!o)for(let l of this.getNetworkDevices())l.onStorageUpdate?.({boundBlock:l.boundBlock,boundEntity:l.boundEntity,network:this});e=s}if(c)i=c;else return}return i}removeItemFromStorage(a,{supressEvent:o=!1}){let i=a.amount,s=this.getStorageCells(),u=O(a),c=[];for(let d of s){let l=d.itemStorage[u]?.amount;if(!l)continue;let p=Math.min(l,i);if(x.info(`Removing ${p}x ${u} from a cell.`,"Storage"),i-=p,d.itemStorage[u].amount-=p,c.push(d),d.itemStorage[u].amount<=0&&delete d.itemStorage[u],i<=0){if(c.forEach(m=>m.setItemStorage(m.itemStorage)),!o)for(let m of this.getNetworkDevices())m.onStorageUpdate?.({boundBlock:m.boundBlock,boundEntity:m.boundEntity,network:this});return e=s,!0}}return x.error(`Failed to remove ${u} from network storage`,"Storage"),!1}getStorageCells(){return this.getNetworkDevices().flatMap(a=>a.provideDisksToNetwork?.({network:this,...a})||[])}getPatterns(){return this.getNetworkDevices().flatMap(a=>a.providePattersToNetwork?.({network:this,...a})||[])}dispose(){n=!1,this.intervalId&&rn.clearRun(this.intervalId),xt.delete(r);for(let a of this.getNetworkDevices())!a.boundEntity||!a.boundEntity.isValid()||(a.onDisconnect?.({boundEntity:a.boundEntity}),a.boundEntity.ae2Network=void 0)}}}import{Player as zo,system as on,world as dr}from"@minecraft/server";import{system as ar}from"@minecraft/server";function or(t,e,n,r){let a=r.getBlock(t),o=r.getBlock(e);if(!a||!o)return!0;let i=se[a.typeId];if(i?.excludedFaces){let u={};i.excludedFaces.forEach(l=>u[l]=!0);let c=a.permutation.getState("minecraft:facing_direction")||"north";if(Zt(u,c)[`ae2be:${n}`])return!0}let s=se[o.typeId];if(s?.excludedFaces){let u={};s.excludedFaces.forEach(m=>u[m]=!0);let c=o.permutation.getState("minecraft:facing_direction")||"north",d=Zt(u,c),p={north:"south",south:"north",east:"west",west:"east",up:"down",down:"up"}[n];if(p&&d[`ae2be:${p}`])return!0}return!1}function ir(t,e){let n=t.getBlock(e);if(!n)return;let r=se[n.typeId];if(r)return r.isBlockEntity?{...se[n.typeId],boundEntity:wt(n,n.permutation),boundBlock:n}:{...r,boundBlock:n,boundEntity:void 0}}function Ao(t,e){let n=[],r=new Set,a=[e];return new Promise(o=>{ar.runJob(function*(){for(;a.length>0;){let i=a.shift(),s=`${i.x}${i.y}${i.z}`;if(r.has(s))continue;r.add(s);let u=ir(t,i);if(u){n.push(u);for(let[c,d]of jt){if(c==="ae2be:zero")continue;let l=N.add(i,d),p=c.replace("ae2be:","");or(i,l,p,t)||a.push(l)}yield}}o(n)}())})}function sr(t,e){let n=[],r=new Set,a=gt.map(o=>N.add(e,o));return new Promise(o=>{ar.runJob(function*(){for(;a.length>0;){let i=a.shift(),s=`${i.x}${i.y}${i.z}`;if(r.has(s))continue;r.add(s);let u=ir(t,i);if(u){n.push(u);for(let[c,d]of jt){if(c==="ae2be:zero")continue;let l=N.add(i,d),p=c.replace("ae2be:","");or(i,l,p,t)||a.push(l)}yield}}o(n)}())})}async function cr(t,e){let n=await Ao(t,e);if(n.length===0)return;let r=rr(n);return x.info(`Created network with ${n.length} devices`,"Network"),r}var an=new Set;async function ur(t){if(t.ae2Network)return;let e=t.getDynamicProperty("ae2be:lastNetworkId")??"unassigned";an.has(e)||(an.add(e),await cr(t.dimension,t.location),an.delete(e))}import{system as Do}from"@minecraft/server";var Po=new Set(["ae2be:terminal","ae2be:request_terminal","ae2be:wireless_access_screen","ae2be:crafting_terminal"]);function ce(t){x.info(`Removing and dropping loot for ${t.typeId}`,"Network");let e=t.getComponent("inventory");if(!e){t.remove(),t.ae2Network?.dispose();return}let n=e.container;if(Po.has(t.typeId)){let r=n.getSlot(0);if(r.hasItem()&&t.dimension.spawnItem(r.getItem(),t.location),t.typeId==="ae2be:crafting_terminal")for(let a=0;a<Ct;a++){if(a===9)continue;let o=n.getSlot(254-a);o.hasItem()&&!Ye.has(o.typeId)&&t.dimension.spawnItem(o.getItem(),t.location)}}else for(let r=0;r<n.size;r++){let a=n.getSlot(r);a.hasItem()&&!Ye.has(a.typeId)&&t.dimension.spawnItem(a.getItem(),t.location)}t.ae2Network?.dispose(),t.remove()}Do.afterEvents.scriptEventReceive.subscribe(t=>{let{id:e,sourceEntity:n}=t;!n||e!=="ae2be:drop_despawn"||ce(n)},{namespaces:["ae2be"]});var Mo=["overworld","nether","the_end"].map(t=>dr.getDimension(t)),qe=!1;function lr(t){let e=t.dimension.getBlock(t.location);if(e&&e.typeId!==t.typeId){ce(t);return}}function $o(){x.info("Initialitzing Integrated Storage Block Entities"),qe=!0,on.runInterval(()=>{for(let t of Bo({families:["block_entity"]}))t.isValid()&&lr(t)},20)}on.runTimeout($o,20);function Vo(t,e){x.warn(`Creating bound entity for block ${t.typeId}`,"Network");let n=e.getState("minecraft:facing_direction"),r=On[n]??{x:0,y:0,z:0};try{let a=t.dimension.spawnEntity(t.typeId,N.add(t.bottomCenter(),r));return a.ae2.boundBlockLocation=t.location,a.nameTag=fr[t.typeId],a}catch{throw`\xA7cFailed to create bound entity for block ${t.typeId}. Was this entity moved with a piston?`}}function wt(t,e){return t.dimension.getEntities({families:["block_entity"],type:e.type.id,location:t.bottomCenter(),closest:1,maxDistance:.8})[0]}var mr={typeId:"ae2be:ticking_block_entity",component:{beforeOnPlayerPlace({block:t,permutationToPlace:e}){on.run(()=>Vo(t,e))},onTick({block:t}){if(!qe)return;let e=wt(t,t.permutation);e&&ur(e)},onPlayerDestroy({block:t,destroyedBlockPermutation:e}){let n=wt(t,e);n&&lr(n)},onPlayerInteract({player:t}){t&&(t.sendMessage({translate:"ae2be:error_block_interact"}),t.playSound("mob.villager.no"))}}};dr.afterEvents.entityHitEntity.subscribe(t=>{let{damagingEntity:e,hitEntity:n}=t;!n.ae2Network||!n.ae2.boundBlockLocation||!(e instanceof zo)||e.sendMessage({translate:"ae2be:error_block_break"})});function Bo(t){return Mo.flatMap(e=>e.getEntities(t))}import{ItemStack as Go,system as Tt,world as cn}from"@minecraft/server";import{StructureSaveMode as jo,system as Lo,world as Fo}from"@minecraft/server";var pr=Bn`recipe_verifier`,Et=Fo.structureManager,Zo={saveMode:jo.Memory,includeBlocks:!0,includeEntities:!0},Qe=new Map,sn=new Set;async function qo(t){let e=Qe.get(t);if(!(!e||e.length===0||sn.has(t))){sn.add(t);try{for(;e.length>0;){let n=e.shift();try{let r=await Uo(n.params);n.resolve(r)}catch(r){n.reject(r)}}}finally{sn.delete(t),e.length===0&&Qe.delete(t)}}}async function hr({inputs:t,location:e,dimension:n}){let r=`${n.id}_${e.x}_${e.z}`;return new Promise((a,o)=>{Qe.has(r)||Qe.set(r,[]),Qe.get(r).push({params:{inputs:t,location:e,dimension:n},resolve:a,reject:o}),qo(r)})}async function Uo({inputs:t,location:e,dimension:n}){let r="ae2be:temp_verifier";Et.delete(r);let a=n.heightRange.min+1,o=a+pr.size.y,i={x:e.x,y:a,z:e.z},s={x:e.x,y:o,z:e.z},u=Et.createFromWorld(r,n,i,s,Zo);Et.place(pr,n,i);for(let g=0;g<t.length;g++){let k=t[g];k&&n.runCommand(`replaceitem block ${e.x} ${a+1} ${e.z} slot.container ${g} ${k}`)}n.setBlockType(i,"minecraft:redstone_block");let c={x:0,y:2,z:0},l=n.getBlock(N.add(i,c))?.getComponent("inventory")?.container;if(!l)throw new Error("Output container not found for recipe verification");await Lo.waitTicks(8);let p=l.size-l.emptySlotsCount;if(p<=0)return[];let m=[];for(let g=0;g<l.size;g++){let k=l.getItem(g);if(k&&(m.push(k),m.length>=p))break}return Et.place(u,n,i),m}var et=254,yr=new Go("ae2be:backsert"),tt={typeId:"ae2be:crafting_terminal",consumesChannels:1,isBlockEntity:!0,blockEntityContainerName:"crafting_terminal.entity.ui",onceConnected(t){ue(t),ne(t)},onStorageUpdate(t){ue(t),ne(t)},onDisconnect({boundEntity:t}){x.info("Disconected. Flushing ","Terminal");let e=t.getComponent("inventory").container,n=e.getSlot(0),r=n.hasItem()&&n.getItem();e.clearAll(),r&&n.setItem(r)},tick(t){let{network:e,boundBlock:n,boundEntity:r}=t;if(!r)return;let a=r.getComponent("inventory")?.container;if(!a)return;let o=Array.from({length:9},(m,g)=>a.getSlot(et-g)),i=a.getSlot(et-9),s=a.getSlot(et-10);if(Tt.currentTick%2===0){s.hasItem()||(s.setItem(yr),o.forEach((k,C)=>{if(!k.hasItem())return;let A=k.getItem(),T=e.mayAddItemToNetwork(Re(A),{supressEvent:!0});Ne(A,T)&&k.setItem(T)}),re(t,{fromSlot:0,toSlot:et-20}));let m=r.dimension.getEntities({type:"minecraft:player",location:r.location,maxDistance:10}),g=r.getDynamicProperty("ae2be:is_active");m.length>0?(g||(x.info(`Terminal ${r.id} is awaken.`,"Terminal"),r.setDynamicProperty("ae2be:is_active",!0),re(t,{fromSlot:0,toSlot:et-20})),ue(t)&&ne(t)):g&&(x.info("Terminal has become inactive","Terminal"),r.setDynamicProperty("ae2be:is_active",!1),Ge(r))}let u=o.map(m=>{if(!(!m||!m.hasItem()))return m.typeId}),c=u.join(","),d=cn.getDynamicProperty(`ae2be:recipe_cache_${c}`),l=d?JSON.parse(d):[],p=l[0]?te(l[0]):void 0;if(r.ae2.temp.get("lastRecipeKey")===c){(p&&(!i.hasItem()||i.isStackableWith(p)&&i.amount!==p.amount)||p&&p.typeId!==i.typeId)&&(o.forEach((m,g)=>{m.hasItem()&&J(m)}),l.slice(1).forEach(m=>{r.dimension.spawnItem(te(m),r.location)}),i.hasItem()&&(r.dimension.spawnItem(i.getItem(),r.location),i.setItem()),r.ae2.temp.set("lastRecipeKey",void 0));return}r.ae2.temp.set("lastRecipeKey",c),i.setItem(p),r.ae2.temp.has("recipeDebounceId")&&Tt.clearRun(r.ae2.temp.get("recipeDebounceId")),r.ae2.temp.set("recipeDebounceId",Tt.runTimeout(async()=>{if(!r.isValid()||!i.isValid())return;o.flatMap(C=>{!C||!C.hasItem()||C.nameTag?.includes(Ue)&&C.setItem(Re(C).getItem())});let m=await hr({dimension:r.dimension,location:r.location,inputs:u});if(!r.isValid()||!i.isValid())return;let k=o.map(C=>{if(!(!C||!C.isValid()||!C.hasItem()))return C.typeId}).join(",");c===k&&(i.setItem(m[0]),cn.setDynamicProperty(`ae2be:recipe_cache_${k}`,JSON.stringify(m.map(z))))},5))}};Tt.runInterval(()=>{for(let t of cn.getAllPlayers()){let e=t.getComponent("cursor_inventory"),n=e.item;n&&n.typeId===yr.typeId&&(e.clear(),t.playSound("random.click"))}},5);var _r="\uE200",dn="\uE201",Ue="\uE202",Jo=0,Ho=Number.MAX_SAFE_INTEGER.toString(16).length,Ct=20,un=new Map;function Ko(t){if(un.has(t))return un.get(t);let e=_r+t.split(":",2)[1].split("_").map(n=>n[0].toUpperCase()+n.substring(1)).join(" ");return un.set(t,e),e}function Xo({itemTemplate:t,amount:e},{networkId:n}){let r=te(t);r.amount=Math.min(e,64);let a=e.toString().padStart(6,"a");return a.length>6&&(a=jn(e).padStart(6,"a")),r.nameTag=a+`${Ue}${(Jo++%Number.MAX_SAFE_INTEGER).toString(16).padStart(Ho,".")}${Ue}${n}${Ue}\xA7r`+(t.nameTag?`${dn}${t.nameTag}`:Ko(r.typeId)),r}function Yo(t){let{boundEntity:e,network:n}=t.event;if(!e||!e.isValid()||!n)return;let r=e.getComponent("inventory").container;return Object.entries(Fe(n.getStorageCells())).slice(t.fromSlot??0,t.toSlot??r.size-1)}function re(t,{fromSlot:e=0,toSlot:n=254}={fromSlot:0,toSlot:254}){let{boundEntity:r,network:a}=t;if(!r||!r.isValid()||!a)return;let o=r.getComponent("inventory").container,s=(Yo({event:t,fromSlot:e,toSlot:n})||[]).sort((l,p)=>p[1].amount-l[1].amount),u=n,c=o.getSlot(0),d=c.hasItem()&&c.getItem();d&&c.setItem(d);for(let l=0;l<u;l++){let p=o.getSlot(l+1);if(!s[l]){p.setItem();continue}let m=Xo(s[l][1],{networkId:a.networkId});(!p.hasItem()||O(p.getItem())!==O(z(m)))&&p.setItem(m)}}function ue(t){let{boundEntity:e,network:n}=t;if(!e||!e.isValid())return!1;let a=e.getComponent("inventory").container.getSlot(0);if(a.hasItem()){if(Ze.has(a.typeId))return e.dimension.spawnItem(a.getItem(),e.location),a.setItem(),e.runCommand('tellraw @p {"rawtext":[{"translate":"ae2be:error_item_invalid"}]}'),!1;let o=a.getItem(),i=n.mayAddItemToNetwork(Re(o),{supressEvent:!0});return Ne(o,i)&&a.setItem(i),!i||o.amount!==i.amount||o.nameTag!==i.nameTag}return!1}function ne({network:t}){t.getNetworkDevices().forEach(e=>{if(e.boundEntity?.getDynamicProperty("ae2be:is_active"))switch(e.typeId){case nt.typeId:re({network:t,boundEntity:e.boundEntity,boundBlock:e.boundBlock});break;case tt.typeId:re({network:t,boundEntity:e.boundEntity,boundBlock:e.boundBlock},{fromSlot:0,toSlot:254-Ct});break}})}function Ge(t){let e=t.getComponent(Nt.Inventory).container,n=e.getSlot(0),r=n.hasItem()&&n.getItem(),a=Array.from({length:Ct},(o,i)=>e.getItem(254-i));if(e.clearAll(),r&&n.setItem(r),t.typeId==="ae2be:crafting_terminal")for(let o=0;o<a.length;o++){let i=a[o];if(!i)continue;e.getSlot(254-o).setItem(i)}}var gr=new Set;function Re(t,e){let n=t.nameTag;function r(){if(!n)return t;let[a,o,i]=n.split(Ue);if(!o||!i)return t;let s=xt.get(i);if(!s||gr.has(o))return t;gr.add(o);let u=s.removeItemFromStorage(z(t),{supressEvent:!0});return e?.(t),ne({network:s}),t}return n?n.includes(_r)?(t.nameTag=void 0,r()):(n.includes(dn)&&(t.nameTag=n.split(dn,2)[1]),r()):t}ln.afterEvents.worldInitialize.subscribe(async()=>{for(let t of Te)t.getEntities({families:["ae2be_terminal"]}).forEach(Ge)});ln.afterEvents.entityLoad.subscribe(async({entity:t})=>{if(qe)return;let e=t.getComponent(Nt.TypeFamily);!e||!e.hasTypeFamily("ae2be_terminal")||Ge(t)});Wo.runInterval(()=>{for(let t of ln.getAllPlayers()){let e=t.getComponent(Nt.Inventory).container,n=t.getComponent(Nt.CursorInventory)?.item;n&&Re(n);for(let r=0;r<e.size-1;r++){let a=e.getSlot(r);a.hasItem()&&Re(a)}}for(let t of Te)t.getEntities({type:"minecraft:item"}).forEach(e=>{let n=e.getComponent("item")?.itemStack;n&&Re(n,r=>{let a=e.location,o=e.dimension;e.remove(),o.spawnItem(r,a)})})});var nt={typeId:"ae2be:terminal",consumesChannels:1,isBlockEntity:!0,blockEntityContainerName:"terminal.entity.ui",onceConnected(t){ue(t),ne(t)},onStorageUpdate(t){ue(t),ne(t)},onDisconnect({boundEntity:t}){x.info("Disconected. Flushing ","Terminal");let e=t.getComponent("inventory").container,n=e.getSlot(0),r=n.hasItem()&&n.getItem();e.clearAll(),r&&n.setItem(r)},tick(t){let{boundEntity:e}=t;if(!e||!e.isValid()||Qo.currentTick%2!==0)return;let n=e.dimension.getEntities({type:"minecraft:player",location:e.location,maxDistance:10}),r=e.getDynamicProperty("ae2be:is_active");n.length>0?(r||(x.info(`Terminal ${e.id} is awaken.`,"Terminal"),e.setDynamicProperty("ae2be:is_active",!0),re(t)),ue(t)&&ne(t)):r&&(x.info("Terminal has become inactive","Terminal"),e.setDynamicProperty("ae2be:is_active",!1),Ge(e))}};import{system as Ir}from"@minecraft/server";var br={from(t){if(!t)return;let e=H.get(t);if(!e)return;let n=t.getComponent("inventory");if(!n)return;let r=n.container,a=e.container?.useStorageBus?.excludedSlots?.length??0,o=a>0;return{registry:e,container:r,load(i,s){function u(){let p=Object.entries(i),m=0;for(;p.length>0;){let[g,k]=p.shift(),C=je(g,k),A=te(C),T=A.maxAmount,w=k.amount,D=Math.ceil(w/T),$=w/T-Math.floor(w/T);for(let le=0;le<D;le++)$==0||le!=D-1?(A.amount=T,r.setItem(m,A)):A.amount=T*$,r.setItem(m++,A)}}function c(){if(!s||s.length===0){r.clearAll();return}for(let p=0;p<r.size;p++){let m=r.getItem(p);m&&s.some(g=>g.isStackableWith(m))&&r.setItem(p,void 0)}}function d(){let p=Array.from({length:a},(m,g)=>r.getItem(g));c();for(let m=0;m<p.length;m++){let g=p[m],k=e?.container?.useStorageBus?.excludedSlots?.[m];g&&r.setItem(k,g)}u()}function l(){c(),u()}o?d():l()},tryAddItemStack(i){return o&&r.emptySlotsCount<=0?i:r.addItem(i)},*getAll(){for(let i=0;i<r.size;i++){if(e.container?.useStorageBus?.excludedSlots?.includes(i))continue;let s=r.getItem(i);s&&(yield s)}}}}},Rt={from(t,e){let n=e.getBlock(t);e:if(n){let a=H.get(n);if(!a)break e;return{component:n.getComponent("inventory"),registry:a}}let r=e.getEntities({location:t,maxDistance:1,closest:1})[0];if(r){let a=H.get(r);return a?{component:r.getComponent("inventory"),registry:a}:void 0}}};import{ItemStack as ei}from"@minecraft/server";function Ot(t,e){let n=t.getSlot(13),r=0,a=0,o=!1;[9,10,11,12].forEach(s=>{let u=t.getItem(s);switch(u?.typeId){case"ae2be:booster_card":r+=u.amount;break;case"ae2be:capacity_card":a+=u.amount;break;case"ae2be:redstone_card":o=!0;break}}),n.setItem(new ei("ae2be:ui_progress",1+a));let i=[t.getItem(0)];a>0&&(i.push(t.getItem(1),t.getItem(2),t.getItem(3),t.getItem(4)),a>1&&i.push(t.getItem(5),t.getItem(6),t.getItem(7),t.getItem(8))),i=i.filter(Boolean),e.ae2.temp.set("filterItems",i),e.ae2.temp.set("boosterCardCount",r),e.ae2.temp.set("capacityCardCount",a),e.ae2.temp.set("hasAnyRedstoneCard",o)}var mn={typeId:"ae2be:import_bus",consumesChannels:1,isBlockEntity:!0,blockEntityContainerName:"import_bus.entity.ui",eventPriority:0,excludedFaces:["ae2be:south"],tick({boundEntity:t,network:e,boundBlock:n}){if(!t||!n)return;let r=t.getComponent("inventory").container;if(Ir.currentTick%20===0&&Ot(r,t),t.ae2.temp.get("hasAnyRedstoneCard")&&(n.getRedstonePower()??0)<=0)return;let a=t.ae2.temp.get("boosterCardCount")??0;if(Ir.currentTick%(20-a*4)!==0)return;let o=t.ae2.temp.get("filterItems")||[],i=n.permutation.getState("minecraft:facing_direction")||"north",s=ee[i],u=N.add(n.location,s),c=Rt.from(u,n.dimension);if(!c)return;let{registry:d,component:l}=c;if(!l||!d.container?.outputSlots||d.container?.outputSlots?.length<=0)return;let p=l.container,m;for(let A of d.container.outputSlots){let T=p.getSlot(A);if(!T.hasItem())continue;if(o.length<=0){m=T;break}if(o.some(D=>D&&T.isStackableWith(D))){m=T;break}}if(!m)return;let g=m.getItem(),k=Math.min(g.amount,Math.max(1,a*4));g.amount=k;let C=e.mayAddItemToNetwork(g,{});if(C){m.amount-=k-C.amount;return}m.amount-k<=0?m.setItem():m.amount-=k}};import{system as kr}from"@minecraft/server";var fn={typeId:"ae2be:export_bus",consumesChannels:1,isBlockEntity:!0,blockEntityContainerName:"export_bus.entity.ui",eventPriority:0,excludedFaces:["ae2be:south"],tick({boundEntity:t,network:e,boundBlock:n}){if(!t||!n)return;let r=t.getComponent("inventory").container;if(kr.currentTick%20===0&&Ot(r,t),t.ae2.temp.get("hasAnyRedstoneCard")&&(n.getRedstonePower()??0)<=0)return;let a=t.ae2.temp.get("boosterCardCount")??0;if(kr.currentTick%(20-a*4)!==0)return;let o=n.permutation.getState("minecraft:facing_direction")||"north",i=ee[o],s=N.add(n.location,i),u=Rt.from(s,n.dimension);if(!u)return;let{registry:c,component:d}=u;if(!d||!c.container?.inputSlots||c.container?.inputSlots?.length<=0)return;let l=t.ae2.temp.get("filterItems");if(!l||l.length<=0)return;let p=t.ae2.temp.get("robinIndex")||0;t.ae2.temp.set("robinIndex",(p+1)%l.length);let m=l[p],g=z(m),k=O(g),C=Fe(e.getStorageCells());if(!C[k])return;let A=C[k],T=d.container,w,D=m.maxAmount;for(let U of c.container.inputSlots){let Oe=T.getSlot(U);if(!Oe.hasItem()){w=Oe;break}if(Oe.isStackableWith(m)){if(m.maxAmount-Oe.amount<=0)continue;w=Oe,D=m.maxAmount-Oe.amount;break}}if(!w)return;let $=Math.min(D,A.amount,Math.max(a*4,1));m.amount=$,e.removeItemFromStorage(m,{})&&(m.amount=w.hasItem()?w.amount+$:$,w.setItem(m))}};import{ContainerSlot as ti,system as ni}from"@minecraft/server";function vr(t){if(!t||!t.isValid())return[];let e=t.getComponent("inventory")?.container;if(!e)return[];let n=[];for(let r=0;r<9;r++){let a=e.getItem(r);a&&n.push(a)}return n}function Sr(t,e){return e.length===0?!0:e.some(n=>n.typeId===t.typeId)}var pn={typeId:"ae2be:storage_bus",consumesChannels:1,isBlockEntity:!0,blockEntityContainerName:"storage_bus.entity.ui",eventPriority:0,excludedFaces:["ae2be:south"],tick({boundEntity:t}){if(!(!t||!t.isValid())&&ni.currentTick%20===0){let e=vr(t);t.ae2.temp.set("filterItems",e)}},provideDisksToNetwork({boundBlock:t,network:e,boundEntity:n}){if(!t||!n)return[];let r=t.permutation.getState("minecraft:facing_direction")||"north",a=ee[r],o=N.add(t.location,a),i=t.dimension.getBlock(o);if(i?.typeId===Le.typeId){let l=t.dimension.getEntities({closest:1,type:Le.typeId,location:o,maxDistance:1})[0];if(!l||l.ae2Network===e)return[];let p=l.ae2Network;if(!p)return[];let m=e._storageCallStack||new Set;if(m.has(p.networkId))return[];let g=new Set(m);g.add(e.networkId);let k=p._storageCallStack;p._storageCallStack=g;try{return p.getStorageCells()}finally{p._storageCallStack=k}}let s=t.dimension.getEntities({closest:1,excludeFamilies:["player","ae2be_exclude","mob","monster","animal","npc"],location:o,maxDistance:1})[0],u=br.from(i||s);if(!u)return[];let c=n.ae2.temp.get("filterItems")||vr(n),d={};for(let l of u.getAll()){if(!Sr(l,c))continue;let p=z(l),m=O(p);delete p.amount,delete p.typeId,d[m]?d[m].amount+=l.amount:d[m]={amount:l.amount,itemTemplate:p}}return[{itemStorage:d,setItemStorage(l){d=l,u.load(l,c)},tryAddItemStack(l,{}){if(l instanceof ti&&(l=l.getItem()),!Sr(l,c))return l;let p=z(l),m=O(p),g=u.tryAddItemStack(l);return this.itemStorage[m]?this.itemStorage[m].amount+=l.amount-(g?.amount??0):this.itemStorage[m]={amount:l.amount-(g?.amount??0),itemTemplate:p},g},unTemplate:je}]}};import{EquipmentSlot as ri,system as hn,world as rt}from"@minecraft/server";var xr=16,yn={typeId:"ae2be:wireless_access_point",consumesChannels:1,isBlockEntity:!0,blockEntityContainerName:"wireless_access_point.entity.ui",tick({boundBlock:t,boundEntity:e,network:n}){if(!t||!e||hn.currentTick%10!==0)return;let r=e.getComponent("minecraft:inventory").container;if(!r)return;let a=r.getSlot(0),o=r.getSlot(1),i=r.getSlot(2);if(o.hasItem()&&o.typeId==="ae2be:wireless_terminal"&&!i.hasItem()){let s=o.getItem();s.setDynamicProperty("ae2be:bound_location",t.location),s.setDynamicProperty("ae2be:bound_dim_id",t.dimension.id),s.setDynamicProperty("ae2be:bound_network",n.networkId),o.setItem(),i.setItem(s)}if(a.hasItem())switch(a.typeId){case"ae2be:wireless_booster_card":let s=Math.floor(Math.pow(a.amount,1.8)*5e3/Math.pow(64,1.8));e.setDynamicProperty("ae2be:range",xr+s);break;case"ae2be:infinite_wireless_booster_card":e.setDynamicProperty("ae2be:range",-1);break}else e.setDynamicProperty("ae2be:range",xr)}};hn.runInterval(()=>{if(!qe)return;let t=rt.getAllPlayers();for(let a of t){let o=function(T){return Te.flatMap(w=>w.getEntities({type:"ae2be:terminal",tags:[`ae2be_${T.id}`]}))},c=function(T){return u.getDynamicProperty(T)||s?.getDynamicProperty(T)},g=function(){s&&(ce(s),m&&(m.ae2Network?.dynamicNetworkEntity.delete(s.id),s=void 0))};var e=o,n=c,r=g;let i=o(a);for(let T=0;T<i.length;T++){let w=i[T];if(T>0||w.dimension.id!==a.dimension.id){ce(w);continue}}let s=i[0];s?.isValid()||(s=void 0);let u=a.getComponent("equippable").getEquipmentSlot(ri.Mainhand),d=c("ae2be:bound_location"),l=c("ae2be:bound_network"),p=c("ae2be:bound_dim_id"),m=p?rt.getDimension(p).getEntities({type:"ae2be:wireless_access_point",location:d,closest:1})[0]:void 0;if((!u.hasItem()||u.typeId!=="ae2be:wireless_terminal"||!m?.ae2Network)&&s){g();continue}if(!d||!l)continue;if(!m){u.clearDynamicProperties(),a.sendMessage({translate:"ae2be:error_wireless_terminal_unlink"});continue}if(s&&!s.hasTag(l)&&g(),!s)try{s=a.dimension.spawnEntity("ae2be:terminal",a.location),s.addTag(`ae2be_${a.id}`),s.addTag(l),s.addTag("wireless_terminal"),s.triggerEvent("ae2be:use_wireless_terminal"),s.setDynamicProperty("ae2be:bound_location",d),s.setDynamicProperty("ae2be:bound_dim_id",p),s.setDynamicProperty("ae2be:bound_network",l),s.nameTag="terminal.entity.ui",m.ae2Network?.dynamicNetworkEntity.set(s.id,{...se[s.typeId],boundEntity:s,boundBlock:void 0}),re({network:m.ae2Network,boundEntity:s}),(s?.getComponent("tameable")).tame(a)}catch{}if(!s)continue;let k=N.add(N.add(a.getHeadLocation(),a.getViewDirection()),{x:0,y:-.5,z:0}),C=a.getVelocity(),A={x:k.x+C.x*6,y:k.y,z:k.z+C.z*6};s.teleport(A)}if(hn.currentTick%60===0)for(let a of Te){let o=a.getEntities({type:"ae2be:terminal",tags:["wireless_terminal"]});for(let i of o)i.getTags().some(u=>t.some(c=>u===`ae2be_${c.id}`))||ce(i)}});rt.beforeEvents.playerInteractWithEntity.subscribe(t=>{let{player:e,target:n,itemStack:r}=t;if(n.typeId!=="ae2be:terminal"||!n.hasTag("wireless_terminal")||!r||r.typeId!=="ae2be:wireless_terminal")return;let a=r.getDynamicProperty("ae2be:bound_location"),o=r.getDynamicProperty("ae2be:bound_network"),i=r.getDynamicProperty("ae2be:bound_dim_id");if(!a||!o||!i)return;let s=rt.getDimension(i).getEntities({type:"ae2be:wireless_access_point",location:a,closest:1})[0];if(!s)return;let u=s.getDynamicProperty("ae2be:range");if(u===void 0)return;if(N.distance(e.location,s.location)>u&&u!==-1){e.sendMessage({translate:"ae2be:error_wireless_terminal_out_of_range"}),t.cancel=!0;return}});rt.afterEvents.worldInitialize.subscribe(()=>{for(let t of Te){let e=t.getEntities({type:"ae2be:terminal",tags:["wireless_terminal"]});for(let n of e)ce(n)}});var wr=[Ut,Qt,qt,nt,tt,Le,Yt,tn,nn,yn,mn,fn,pn,An],Ye=new Set(["ae2be:ui_progress","ae2be:backsert"]),Ze=new Set(["minecraft:bundle","minecraft:undyed_shulker_box","minecraft:firework_rocket","minecraft:firework_star",...Object.values(ai).flatMap(t=>{let e=t.toLowerCase();return[`minecraft:${e}_shulker_box`,`minecraft:${e}_bundle`]})]),se=wr.reduce((t,e)=>(t[e.typeId]=e,t),{}),fr=wr.reduce((t,e)=>(e.blockEntityContainerName&&(t[e.typeId]=e.blockEntityContainerName),t),{});var Cr={},ii="ae2be://api/v1",si=R.object({typeId:R.string().includes(":",{message:"The typeId for the block must be namespaced"}),containerType:R.enum(["block","entity"]),container:R.optional(R.object({insertsItems:R.optional(R.boolean()),useStorageBus:R.optional(R.object({excludedSlots:R.optional(R.array(R.number()))})),inputSlots:R.optional(R.array(R.number())),outputSlots:R.optional(R.array(R.number()))}))}),ci=R.object({systemExludedItemTypes:R.optional(R.array(R.string())),systemDropExcludeItemTypes:R.optional(R.array(R.string()))});function Er(t,e){Cr[`${ii}${t}`]=e}oi.afterEvents.scriptEventReceive.subscribe(t=>{let{id:e,message:n}=t;if(!e.startsWith("ae2be://api"))return;let r=Cr[e];if(!r){x.error(`Endpoint not found: ${e}`);return}r(n)},{namespaces:["ae2be"]});Er("/container-registry",t=>{try{let e=JSON.parse(t),n=si.parse(e);H.set(n.typeId,n),x.debug(`Added block to registry: ${n.typeId}`)}catch(e){x.error(`Failed to add block to registry: ${JSON.stringify(e)}`)}});Er("/global-registry",t=>{try{let e=JSON.parse(t),n=ci.parse(e);x.debug(`Added global registry: ${JSON.stringify(n)}`),n.systemExludedItemTypes&&n.systemExludedItemTypes.forEach(r=>{Ze.add(r)}),n.systemDropExcludeItemTypes&&n.systemDropExcludeItemTypes.forEach(r=>{Ye.add(r)})}catch(e){x.error(`Failed to add global registry: ${JSON.stringify(e)}`)}});import{world as gi}from"@minecraft/server";import{BlockPermutation as ui}from"@minecraft/server";var di={north:{"ae2be:north":"ae2be:south","ae2be:south":"ae2be:north","ae2be:east":"ae2be:west","ae2be:west":"ae2be:east","ae2be:up":"ae2be:up","ae2be:down":"ae2be:down"},south:{"ae2be:north":"ae2be:north","ae2be:south":"ae2be:south","ae2be:east":"ae2be:east","ae2be:west":"ae2be:west","ae2be:up":"ae2be:up","ae2be:down":"ae2be:down"},east:{"ae2be:north":"ae2be:east","ae2be:south":"ae2be:west","ae2be:east":"ae2be:south","ae2be:west":"ae2be:north","ae2be:up":"ae2be:up","ae2be:down":"ae2be:down"},west:{"ae2be:north":"ae2be:west","ae2be:south":"ae2be:east","ae2be:east":"ae2be:north","ae2be:west":"ae2be:south","ae2be:up":"ae2be:up","ae2be:down":"ae2be:down"},up:{"ae2be:north":"ae2be:up","ae2be:south":"ae2be:down","ae2be:east":"ae2be:east","ae2be:west":"ae2be:west","ae2be:up":"ae2be:south","ae2be:down":"ae2be:north"},down:{"ae2be:north":"ae2be:down","ae2be:south":"ae2be:up","ae2be:east":"ae2be:east","ae2be:west":"ae2be:west","ae2be:up":"ae2be:north","ae2be:down":"ae2be:south"}};function gn(t,e=!0){let n=t.permutation.getState("minecraft:facing_direction"),r=n||"north",a=t.hasTag("ae2be:network_cable"),o={"ae2be:north":!1,"ae2be:south":!1,"ae2be:west":!1,"ae2be:east":!1,"ae2be:up":!1,"ae2be:down":!1};if(Object.entries(ee).forEach(([u,c])=>{let d=N.add(t.location,c),l=t.dimension.getBlock(d);l&&l.hasTag("ae2be:network_connectable")&&(o[`ae2be:${u}`]=!0,e&&gn(l,!1))}),t.isAir||!a)return;let i=di[r],s={"ae2be:north":!1,"ae2be:south":!1,"ae2be:west":!1,"ae2be:east":!1,"ae2be:up":!1,"ae2be:down":!1};Object.entries(o).forEach(([u,c])=>{let d=n?i[u]:u;s[d]=c}),t.setPermutation(ui.resolve(t.typeId,{...t.permutation.getAllStates(),...s}))}async function Tr(t,e){(await sr(t,e)).some(n=>{let r=n.boundEntity?.ae2Network;return r?(r.dispose(),!0):!1})}var Nr={typeId:"ae2be:network_connectable",component:{onPlace({block:t}){gn(t),Tr(t.dimension,t.location)},async onPlayerDestroy({block:t,destroyedBlockPermutation:e}){gn(t),Tr(t.dimension,t.location)}}};import{EquipmentSlot as li}from"@minecraft/server";var mi=["minecraft:iron_tier","minecraft:diamond_tier","minecraft:netherite_tier"],Rr={typeId:"ae2be:ore_xp",component:{onPlayerDestroy({block:t,player:e}){if(!e||e.getGameMode()==="creative")return;let n=e.getComponent("equippable").getEquipmentSlot(li.Mainhand);if(!n||!n.hasItem())return;let r=n.getTags();if(!r.includes("minecraft:is_pickaxe")||!r.some(o=>mi.includes(o)))return;let a=Math.floor(Math.random()*8)+1;for(let o=0;o<a;o++)t.dimension.spawnEntity("minecraft:xp_orb",t.location)}}};function fi(t){return{up:t.above(),down:t.below(),north:t.north(),east:t.east(),south:t.south(),west:t.west(),north_east:t.north()?.east(),east_south:t.east()?.south(),south_west:t.south()?.west(),west_north:t.west()?.north()}}function Or(t,e,n="break"){let r=fi(t),a=n==="placed";for(let o in r){let i=r[o];if(i?.typeId===e){if(a){let u=t.permutation.withState(`ae2be:${o}`,a);t.setPermutation(u)}let s=i.permutation.withState(`ae2be:${Bt[o]}`,a);i.setPermutation(s)}}}var Ar={typeId:"ae2be:connected_glass",component:{onPlace({block:t}){Or(t,t.typeId,"placed")},onPlayerDestroy({block:t,destroyedBlockPermutation:e}){Or(t,e.type.id,"break")}}};import{EquipmentSlot as pi,ItemStack as zr}from"@minecraft/server";var Dr=new zr("ae2be:charged_certus_quartz_crystal"),Pr=new zr("ae2be:certus_quartz_crystal"),de="ae2be:charger_state",Mr={typeId:"ae2be:charger",component:{onPlayerDestroy({block:t,dimension:e,destroyedBlockPermutation:n}){switch(n.getState(de)){case"has_output":e.spawnItem(Dr,t.center());break;case"has_input":e.spawnItem(Pr,t.center());break}},onPlayerInteract({block:t,dimension:e,player:n}){if(!n)return;let r=n.getComponent("equippable").getEquipmentSlot(pi.Mainhand);function a(){if(!r.hasItem()||r.typeId!=="ae2be:certus_quartz_crystal")return!1;J(r);let o=t.permutation.withState(de,"has_input");return t.setPermutation(o),!0}switch(t.permutation.getState(de)){case"empty":a();break;case"has_input":e.spawnItem(Pr,t.center()),t.setPermutation(t.permutation.withState(de,"empty"));break;case"has_output":if(!a()){let o=t.permutation.withState(de,"empty");t.setPermutation(o)}e.spawnItem(Dr,t.center());break}},onTick({block:t}){if(t.permutation.getState(de)!=="has_input")return;function e(){let r=t.permutation.withState(de,"has_output");t.setPermutation(r)}function n(){let r=t.permutation.withState(de,"empty");t.setPermutation(r)}e()}}};import{EquipmentSlot as hi,ItemStack as Z}from"@minecraft/server";function yi(t){let e=t.dimension.getEntities({type:"ae2be:quartz_grindstone",location:t.center(),closest:1,maxDistance:.5})[0]||t.dimension.spawnEntity("ae2be:quartz_grindstone",t.center()),n=e.getComponent("inventory").container;return{entity:e,container:n,inputSlot:n.getSlot(0)}}var $r={"minecraft:iron_ingot":new Z("ae2be:iron_dust"),"minecraft:gold_ingot":new Z("ae2be:gold_dust"),"minecraft:ender_pearl":new Z("ae2be:ender_dust"),"minecraft:quartz":new Z("ae2be:nether_quartz_dust"),"ae2be:charged_certus_quartz_crystal":new Z("ae2be:certus_quartz_dust"),"ae2be:certus_quartz_crystal":new Z("ae2be:certus_quartz_dust"),"ae2be:fluix_crystal":new Z("ae2be:fluix_dust"),"ae2be:pure_certus_quartz_crystal":new Z("ae2be:certus_quartz_dust"),"ae2be:pure_flux_crystal":new Z("ae2be:fluix_dust"),"ae2be:pure_nether_quartz":new Z("ae2be:nether_quartz_dust"),"ae2be:sky_stone":new Z("ae2be:sky_stone_dust")},Vr={typeId:"ae2be:quartz_grindstone",component:{onPlayerInteract({block:t,player:e,dimension:n}){if(!e)return;let{entity:r,inputSlot:a}=yi(t);if(a.hasItem()){let o=$r[a.typeId],i=a.getItem();n.spawnItem(o||i,t.center()),r.runCommand("replaceitem entity @s slot.weapon.mainhand 0 air"),r.remove()}else{let o=e.getComponent("equippable").getEquipmentSlot(hi.Mainhand);if(!o.hasItem())return;if(o.typeId in $r){let i=o.getItem();J(o),a.setItem(new Z(i.typeId)),r.runCommand(`replaceitem entity @s slot.weapon.mainhand 0 ${i.typeId}`)}}}}};var _i=[Nr,mr,Rr,Ar,Mr,Vr];gi.beforeEvents.worldInitialize.subscribe(t=>{_i.forEach(({typeId:e,component:n})=>{t.blockComponentRegistry.registerCustomComponent(e,n)})});import{ItemStack as Br,system as bi,world as Ii}from"@minecraft/server";var ki=["minecraft:redstone","minecraft:quartz","ae2be:charged_certus_quartz_crystal"],vi=new Br("ae2be:fluix_crystal",2),Si=Ii.getDimension("overworld");bi.runInterval(()=>{let t=[];for(let n of Si.getEntities({type:"minecraft:item"})){if(!n.isInWater)continue;let r=n.getComponent("minecraft:item");if(!r)continue;let a=r.itemStack;a&&ki.includes(a.typeId)&&t.push({itemEntity:n,itemStack:a})}for(let{itemEntity:n,itemStack:r}of t){let u=function(c,d){d.remove(),c.amount-1>0&&i.spawnItem(new Br(c.typeId,c.amount-1),s)};var e=u;if(r.typeId!=="ae2be:charged_certus_quartz_crystal")continue;let a=t.find(c=>c.itemStack.typeId==="minecraft:redstone"&&N.distance(c.itemEntity.location,n.location)<2),o=t.find(c=>c.itemStack.typeId==="minecraft:quartz"&&N.distance(c.itemEntity.location,n.location)<2);if(!a||!o||!a.itemEntity.isValid()||!o.itemEntity.isValid()||!n.isValid())continue;let i=n.dimension,s=n.location;u(a.itemStack,a.itemEntity),u(o.itemStack,o.itemEntity),u(r,n),i.spawnItem(vi,s)}});
